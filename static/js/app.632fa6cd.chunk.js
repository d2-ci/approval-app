(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[135],{639:function(e,t,a){e.exports={wrapper:"error-message_wrapper__17C15"}},640:function(e,t,a){e.exports={container:"approval-status-icon_container__1f38G"}},641:function(e,t,a){e.exports={button:"retry-button_button__3hr3p"}},647:function(e,t,a){e.exports={summary:"approve-modal_summary__1abcn",summaryTitle:"approve-modal_summaryTitle__2sA2i",summaryList:"approve-modal_summaryList__1lufS",confirmationStatement:"approve-modal_confirmationStatement__1LDKw"}},648:function(e,t,a){e.exports={bottomBarItem:"bottom-bar-item_bottomBarItem__2GbAg"}},649:function(e,t,a){e.exports={bottomBar:"bottom-bar_bottomBar__2CojG"}},650:function(e,t,a){e.exports={display:"display_display__pmr3Z",chooseDataSet:"display_chooseDataSet__2HsJD display_display__pmr3Z",loadingWrapper:"display_loadingWrapper__iFDcl",noData:"display_noData__2YWIA display_display__pmr3Z",nonDefaultFormWarning:"display_nonDefaultFormWarning__3MIpe"}},651:function(e,t,a){e.exports={titleCell:"table_titleCell__A7ods",dataTable:"table_dataTable__30s_x",cell:"table_cell__3nngY",labelCellContent:"table_labelCellContent__2gJrx"}},652:function(e,t,a){e.exports={titleBar:"title-bar_titleBar__3Zvkn",workflowName:"title-bar_workflowName__1S55b",workflowDataSetsCount:"title-bar_workflowDataSetsCount__t1ej1"}},653:function(e,t,a){e.exports={button:"clear-all-button_button__mDEHm"}},654:function(e,t,a){e.exports={button:"context-select_button__1y8va",prefix:"context-select_prefix__3xDFu",value:"context-select_value__oltZj",tooltipwrap:"context-select_tooltipwrap__3Fqbe"}},655:function(e,t,a){e.exports={container:"approval-status-icons-legend_container__eFk9p",label:"approval-status-icons-legend_label__1zQia"}},656:function(e,t,a){e.exports={container:"approval-status-label_container__1xOLq",iconContainer:"approval-status-label_iconContainer__3bZcv",loadingIcon:"approval-status-label_loadingIcon__96xFy",loading:"approval-status-label_loading__3HPLn"}},657:function(e,t,a){e.exports={popoverContainer:"org-unit-select_popoverContainer__3jDDB",scrollbox:"org-unit-select_scrollbox__23k48"}},658:function(e,t,a){e.exports={menu:"period-menu_menu__2CHPS"}},659:function(e,t,a){e.exports={container:"year-navigator_container__3XXd2",year:"year-navigator_year__14nbM"}},660:function(e,t,a){e.exports={bordered:"workflow-select-option_bordered__JBAIX",option:"workflow-select-option_option__1cqTS",title:"workflow-select-option_title__3zrtv",subtitle:"workflow-select-option_subtitle__3yrup"}},661:function(e,t,a){e.exports={message:"workflow-select_message__1jq5N"}},662:function(e,t,a){e.exports={container:"layout_container__Cp-96",top:"layout_top__2gcI9",content:"layout_content__10QOH",bottom:"layout_bottom__2toTd"}},663:function(e){e.exports=JSON.parse('{"Not authorized":"Not authorized","You don\'t have access to the Data Approval App. Contact a system administrator to request access.":"You don\'t have access to the Data Approval App. Contact a system administrator to request access.","Acceptance failed: {{error}}":"Acceptance failed: {{error}}","Accept":"Accept","Approval saved":"Approval saved","Approve":"Approve","Approving {{count}} data sets":"Approving {{count}} data sets","Approving {{count}} data sets_plural":"Approving {{count}} data sets","Approving {{count}} data set":"Approving {{count}} data set","Approving {{count}} data set_plural":"Approving {{count}} data set","Are you sure you want to approve this data?":"Are you sure you want to approve this data?","There was a problem saving this approval":"There was a problem saving this approval","This data couldn\u2019t be approved. Try again, or contact your system administrator.":"This data couldn\u2019t be approved. Try again, or contact your system administrator.","Cancel":"Cancel","Unacceptance failed: {{error}}":"Unacceptance failed: {{error}}","Unaccept":"Unaccept","Unapproval failed: {{error}}":"Unapproval failed: {{error}}","Unapprove":"Unapprove","This workflow does not contain any data sets.":"This workflow does not contain any data sets.","Choose a data set to review":"Choose a data set to review","{{- workflowName}} has multiple data sets. Choose a data set from the tabs above.":"{{- workflowName}} has multiple data sets. Choose a data set from the tabs above.","Loading data set":"Loading data set","There was a problem displaying this data set":"There was a problem displaying this data set","This data set couldn\'t be loaded or displayed. Try again, or contact your system administrator.":"This data set couldn\'t be loaded or displayed. Try again, or contact your system administrator.","Retry loading data set":"Retry loading data set","This data set doesn\'t have any data for {{- period}} in {{- orgUnit}}.":"This data set doesn\'t have any data for {{- period}} in {{- orgUnit}}.","1 data set":"1 data set","{{dataSetsCount}} data sets":"{{dataSetsCount}} data sets","Approved {{- dateTimeStr}}":"Approved {{- dateTimeStr}}","Ready for approval":"Ready for approval","Waiting for lower level approval":"Waiting for lower level approval","Waiting for higher level approval":"Waiting for higher level approval","Approval by {{- name}} accepted {{timeAgo}}":"Approval by {{- name}} accepted {{timeAgo}}","Approved by {{- name}} {{timeAgo}}":"Approved by {{- name}} {{timeAgo}}","Approved at higher level":"Approved at higher level","You do not have authority to approve data":"You do not have authority to approve data","Cannot be approved":"Cannot be approved","Could not retrieve approval status":"Could not retrieve approval status","January":"January","February":"February","March":"March","April":"April","May":"May","June":"June","July":"July","August":"August","September":"September","October":"October","November":"November","December":"December","Week {{weekNumber}}":"Week {{weekNumber}}","Bi-Week {{biWeekNumber}}":"Bi-Week {{biWeekNumber}}","Daily":"Daily","Weekly":"Weekly","Weekly (Start Wednesday)":"Weekly (Start Wednesday)","Weekly (Start Thursday)":"Weekly (Start Thursday)","Weekly (Start Saturday)":"Weekly (Start Saturday)","Weekly (Start Sunday)":"Weekly (Start Sunday)","Bi-weekly":"Bi-weekly","Monthly":"Monthly","Bi-monthly":"Bi-monthly","Quarterly":"Quarterly","Six-monthly":"Six-monthly","Six-monthly April":"Six-monthly April","Yearly":"Yearly","Financial year (Start November)":"Financial year (Start November)","Financial year (Start October)":"Financial year (Start October)","Financial year (Start July)":"Financial year (Start July)","Financial year (Start April)":"Financial year (Start April)","Clear selections":"Clear selections","Waiting for approval":"Waiting for approval","Approved":"Approved","Failed to load approval state":"Failed to load approval state","Choose a period first":"Choose a period first","Choose a workflow and period first":"Choose a workflow and period first","Organisation Unit":"Organisation Unit","Choose an organisation unit":"Choose an organisation unit","Period":"Period","Choose a period":"Choose a period","Choose a workflow first":"Choose a workflow first","Workflow":"Workflow","Choose a workflow":"Choose a workflow","No workflows found. None may exist, or you may not have access to any.":"No workflows found. None may exist, or you may not have access to any.","Could not load approval data":"Could not load approval data","Retry loading approval data":"Retry loading approval data"}')},666:function(e,t,a){"use strict";a.r(t);var r=a(9),o=a(0),l=a.n(o);const n=Object(o.createContext)({authorities:[],organisationUnits:[],dataApprovalWorkflows:[]});var s=a(7),i=a(639),d=a.n(i);const p=({children:e,title:t})=>l.a.createElement("div",{className:d.a.wrapper},l.a.createElement(r.E,{error:!0,title:t},e));var c=a(5);const u="Daily",m="Weekly",v="WeeklyWednesday",y="WeeklyThursday",f="WeeklySaturday",g="WeeklySunday",w="BiWeekly",h="Monthly",E="BiMonthly",b="Quarterly",S="SixMonthly",D="SixMonthlyApril",_="Yearly",N="FinancialApril",k="FinancialJuly",A="FinancialOct",C="FinancialNov",$=new Set([u,m,v,y,f,g,w,h,E,b,S,D,_,N,k,A,C]),O=e=>$.has(e),T=e=>[c.a.t("January"),c.a.t("February"),c.a.t("March"),c.a.t("April"),c.a.t("May"),c.a.t("June"),c.a.t("July"),c.a.t("August"),c.a.t("September"),c.a.t("October"),c.a.t("November"),c.a.t("December")][e],F=()=>new Date(Date.now()),x=e=>{const t=parseInt(e,10)||0;return F().getFullYear()+t},P=(e,t)=>a=>{let r=[];const o=a.filterFuturePeriods,l=a.reversePeriods,n=x(a.offset),s=new Date(`01 Jan ${n}`);for(;s.getFullYear()===n;){const t={};t.startDate=e(s),t.endDate=t.startDate,t.displayName=t.startDate,t.iso=t.startDate.replace(/-/g,""),t.id=t.iso,r.push(t),s.setDate(s.getDate()+1)}return r=o?t(r):r,r=l?r.reverse():r,r},W=(e,t,a)=>r=>{let o=[];const l=r.filterFuturePeriods,n=r.reversePeriods,s=x(r.offset),i=((e,t=1)=>{const a=new Date(e,0,4),r=a.getDay(),o=a,l=r-t;return l>0?o.setDate(a.getDate()-l):l<0&&(o.setDate(a.getDate()-l),o.setDate(o.getDate()-7)),o})(s,t.startDay);let d=1;for(;i.getFullYear()<=s;){const a={};a.startDate=e(i),a.iso=`${s}${t.shortName}W${d}`,a.id=a.iso,i.setDate(i.getDate()+6),a.endDate=e(i);const r=d;if(a.displayName=`${c.a.t("Week {{weekNumber}}",{weekNumber:r})} - ${a.startDate} - ${a.endDate}`,i.getFullYear()>s&&i.getDate()>=4)break;o.push(a),i.setDate(i.getDate()+1),d+=1}return o=l?a(o):o,o=n?o.reverse():o,o},I=(e,t)=>a=>{let r=[];const o=a.filterFuturePeriods,l=a.reversePeriods,n=x(a.offset),s=new Date(`01 Jan ${n}`),i=s.getDay();let d=1;for(i<=4?s.setDate(s.getDate()-(i-1)):s.setDate(s.getDate()+(8-i));s.getFullYear()<=n;){const t={};t.iso=`${n}BiW${d}`,t.id=t.iso,t.startDate=e(s),s.setDate(s.getDate()+13),t.endDate=e(s);const a=d;if(t.displayName=`${c.a.t("Bi-Week {{biWeekNumber}}",{biWeekNumber:a})} - ${t.startDate} - ${t.endDate}`,s.getFullYear()>n&&s.getDate()>=4)break;r.push(t),s.setDate(s.getDate()+1),d+=1}return r=o?t(r):r,r=l?r.reverse():r,r},U=(e,t)=>{const a=e=>{const t=e.getFullYear();let a=String(e.getMonth()+1);return a=a.length<2?`0${a}`:a,t+a};return r=>{let o=[];const l=r.filterFuturePeriods,n=r.reversePeriods,s=x(r.offset),i=new Date(`31 Dec ${s}`);for(;i.getFullYear()===s;){const t={};t.endDate=e(i),i.setDate(1),t.startDate=e(i);const r=T(i.getMonth());t.displayName=`${r} ${s}`,t.iso=a(i),t.id=t.iso,o.push(t),i.setDate(0)}return o=l?t(o):o,o=n?o:o.reverse(),o}},Y=(e,t)=>a=>{let r=[];const o=a.filterFuturePeriods,l=a.reversePeriods,n=x(a.offset),s=new Date(`31 Dec ${n}`);let i=6;for(;s.getFullYear()===n;){const t={};t.endDate=e(s),s.setDate(0),s.setDate(1),t.startDate=e(s);const a=T(s.getMonth()),o=T(s.getMonth()+1),l=s.getFullYear();t.displayName=`${a} - ${o} ${l}`,t.iso=`${n}0${i}B`,t.id=t.iso,r.push(t),s.setDate(0),i--}return r=o?t(r):r,r=l?r:r.reverse(),r},j=(e,t)=>a=>{let r=[];const o=a.filterFuturePeriods,l=a.reversePeriods,n=x(a.offset),s=new Date(`31 Dec ${n}`);let i=4;for(;s.getFullYear()===n;){const t={};t.endDate=e(s),s.setDate(0),s.setDate(0),s.setDate(1),t.startDate=e(s);const a=T(s.getMonth()),o=T(s.getMonth()+2),l=s.getFullYear();t.displayName=`${a} - ${o} ${l}`,t.iso=`${n}Q${i}`,t.id=t.iso,r.push(t),s.setDate(0),i-=1}return r=o?t(r):r,r=l?r:r.reverse(),r},M=e=>t=>{let a=[];const r=t.filterFuturePeriods,o=t.reversePeriods,l=x(t.offset);let n={};return n.startDate=`${l}-04-01`,n.endDate=`${l}-09-30`,n.displayName=`${T(3)} - ${T(8)} ${l}`,n.iso=`${l}AprilS1`,n.id=n.iso,a.push(n),n={},n.startDate=`${l}-10-01`,n.endDate=`${l+1}-03-31`,n.displayName=`${T(9)} ${l} - ${T(2)} ${l+1}`,n.iso=`${l}AprilS2`,n.id=n.iso,a.push(n),a=r?e(a):a,a=o?a.reverse():a,a},R=(e,t)=>a=>{let r=[];const o=a.filterFuturePeriods,l=a.reversePeriods,n=x(a.offset),s=new Date(`31 Dec ${n}`);for(;n-s.getFullYear()<10;){const t={};t.endDate=e(s),s.setMonth(0,1),t.startDate=e(s);const a=s.getFullYear().toString();t.displayName=a,t.iso=s.getFullYear().toString(),t.id=t.iso.toString(),r.push(t),s.setDate(0)}return r=o?t(r):r,r=l?r:r.reverse(),r},L=(e,t)=>a=>{let r=[];const o=a.filterFuturePeriods,l=a.reversePeriods,n=x(a.offset),s=new Date(`30 Sep ${n+1}`);for(let t=0;t<10;t++){const t={};t.endDate=e(s),s.setYear(s.getFullYear()-1),s.setDate(s.getDate()+1),t.startDate=e(s);const a=s.getFullYear(),o=s.getFullYear()+1;t.displayName=`${T(9)} ${a} - ${T(8)} ${o}`,t.id=`${s.getFullYear()}Oct`,r.push(t),s.setDate(s.getDate()-1)}return r=o?t(r):r,r=l?r:r.reverse(),r},B=(e,t)=>a=>{let r=[];const o=a.filterFuturePeriods,l=a.reversePeriods,n=x(a.offset),s=new Date(`31 Oct ${n+1}`);for(let t=0;t<10;t++){const t={};t.endDate=e(s),s.setYear(s.getFullYear()-1),s.setDate(s.getDate()+1),t.startDate=e(s);const a=s.getFullYear(),o=s.getFullYear()+1;t.displayName=`${T(10)} ${a} - ${T(9)} ${o}`,t.id=`${s.getFullYear()}Nov`,r.push(t),s.setDate(s.getDate()-1)}return r=o?t(r):r,r=l?r:r.reverse(),r},V=(e,t)=>a=>{let r=[];const o=a.filterFuturePeriods,l=a.reversePeriods,n=x(a.offset),s=new Date(`30 Jun ${n+1}`);for(let t=0;t<10;t++){const t={};t.endDate=e(s),s.setYear(s.getFullYear()-1),s.setDate(s.getDate()+1),t.startDate=e(s);const a=s.getFullYear(),o=s.getFullYear()+1;t.displayName=`${T(6)} ${a} - ${T(5)} ${o}`,t.id=`${s.getFullYear()}July`,r.push(t),s.setDate(s.getDate()-1)}return r=o?t(r):r,r=l?r:r.reverse(),r},H=(e,t)=>a=>{let r=[];const o=a.filterFuturePeriods,l=a.reversePeriods,n=x(a.offset),s=new Date(`31 Mar ${n+1}`);for(let t=0;t<10;t++){const t={};t.endDate=e(s),s.setYear(s.getFullYear()-1),s.setDate(s.getDate()+1),t.startDate=e(s);const a=s.getFullYear(),o=s.getFullYear()+1;t.displayName=`${T(3)} ${a} - ${T(2)} ${o}`,t.id=`${s.getFullYear()}April`,r.push(t),s.setDate(s.getDate()-1)}return r=o?t(r):r,r=l?r:r.reverse(),r},J=e=>{const t=e.getFullYear();let a=String(e.getMonth()+1),r=String(e.getDate());return a=a.length<2?`0${a}`:a,r=r.length<2?`0${r}`:r,`${t}-${a}-${r}`},z=e=>{const t=[],a=F();for(let r=0;r<e.length;r++)new Date(e[r].startDate)<=a&&t.push(e[r]);return t},q=({formatYyyyMmDd:e=J,filterFuturePeriods:t=z}={})=>{return[{type:u,regex:/^([0-9]{4})([0-9]{2})([0-9]{2})$/,getPeriods:P(e,t),displayName:c.a.t("Daily")},{type:m,regex:/^([0-9]{4})()W([0-9]{1,2})$/,getPeriods:W(e,{shortName:"",startDay:1},t),displayName:c.a.t("Weekly")},{type:v,regex:/^([0-9]{4})(Wed)W([0-9]{1,2})$/,getPeriods:W(e,{shortName:"Wed",startDay:3},t),displayName:c.a.t("Weekly (Start Wednesday)")},{type:y,regex:/^([0-9]{4})(Thu)W([0-9]{1,2})$/,getPeriods:W(e,{shortName:"Thu",startDay:4},t),displayName:c.a.t("Weekly (Start Thursday)")},{type:f,regex:/^([0-9]{4})(Sat)W([0-9]{1,2})$/,getPeriods:W(e,{shortName:"Sat",startDay:6},t),displayName:c.a.t("Weekly (Start Saturday)")},{type:g,regex:/^([0-9]{4})(Sun)W([0-9]{1,2})$/,getPeriods:W(e,{shortName:"Sun",startDay:7},t),displayName:c.a.t("Weekly (Start Sunday)")},{type:w,regex:/^([0-9]{4})BiW([0-9]{1,2})$/,getPeriods:I(e,t),displayName:c.a.t("Bi-weekly")},{type:h,regex:/^([0-9]{4})([0-9]{2})$/,getPeriods:U(e,t),displayName:c.a.t("Monthly")},{type:E,regex:/^([0-9]{4})([0-9]{2})B$/,getPeriods:Y(e,t),displayName:c.a.t("Bi-monthly")},{type:b,regex:/^([0-9]{4})Q([1234])$/,getPeriods:j(e,t),displayName:c.a.t("Quarterly")},{type:S,regex:/^([0-9]{4})S([12])$/,getPeriods:(a=t,e=>{let t=[];const r=e.filterFuturePeriods,o=e.reversePeriods,l=x(e.offset);let n={};return n.startDate=`${l}-01-01`,n.endDate=`${l}-06-30`,n.displayName=`${T(0)} - ${T(5)} ${l}`,n.iso=`${l}S1`,n.id=n.iso,t.push(n),n={},n.startDate=`${l}-07-01`,n.endDate=`${l}-12-31`,n.displayName=`${T(6)} - ${T(11)} ${l}`,n.iso=`${l}S2`,n.id=n.iso,t.push(n),t=r?a(t):t,t=o?t.reverse():t,t}),displayName:c.a.t("Six-monthly")},{type:D,regex:/^([0-9]{4})AprilS([12])$/,getPeriods:M(t),displayName:c.a.t("Six-monthly April")},{type:_,regex:/^([0-9]{4})$/,getPeriods:R(e,t),displayName:c.a.t("Yearly")},{type:C,regex:/^([0-9]{4})Nov$/,getPeriods:B(e,t),displayName:c.a.t("Financial year (Start November)")},{type:A,regex:/^([0-9]{4})Oct$/,getPeriods:L(e,t),displayName:c.a.t("Financial year (Start October)")},{type:k,regex:/^([0-9]{4})July$/,getPeriods:V(e,t),displayName:c.a.t("Financial year (Start July)")},{type:N,regex:/^([0-9]{4})April$/,getPeriods:H(e,t),displayName:c.a.t("Financial year (Start April)")}];var a},Z=e=>{const t=parseInt(e,10);if(!Number.isInteger(t))throw new Error(`Invalid year "${e}" passed to "getYearOffsetFromNow"`);return t-F().getFullYear()},Q=({periodType:e,year:t,formatYyyyMmDd:a,filterFuturePeriods:r,config:o})=>{const l=(({periodType:e,formatYyyyMmDd:t,filterFuturePeriods:a})=>{if(!O(e))throw new Error(`Invalid period type "${e}" supplied to "getFixedPeriodType"`);const r=q({formatYyyyMmDd:t,filterFuturePeriods:a}).find((({type:t})=>t===e));if(!r)throw new Error(`Could not find periodType object for "${e}"`);return r})({periodType:e,formatYyyyMmDd:a,filterFuturePeriods:r}),n=Z(t);return l&&Number.isInteger(n)?l.getPeriods({...o,offset:n}):[]},G=e=>!isNaN(e.getTime()),K=(e,t,a)=>{if(t=new Date(t),a=new Date(a),!G(t))throw new Error("Invalid startDate provided to getFixedPeriodsForTypeAndDateRange");if(!G(a))throw new Error("Invalid endDate provided to getFixedPeriodsForTypeAndDateRange");let r=a.getFullYear(),o=!1;const l=[];for(;!o;)Q({periodType:e,year:r}).reverse().forEach((e=>{const r=new Date(e.endDate),n=r>=t;n||(o=!0),n&&r<=a&&l.push(e)})),--r;return l.reverse()},X=()=>l.a.createElement(r.e,null,l.a.createElement(r.f,null));var ee=a(34),te=a.n(ee);const ae=({color:e})=>l.a.createElement("svg",{height:"16",viewBox:"0 0 16 16",width:"16",xmlns:"http://www.w3.org/2000/svg",color:e},l.a.createElement("path",{d:"m7 10.707-2.5-2.5005.7065-.7065 1.7935 1.793 3.7925-3.793.7075.7075zm1-9.707c-3.86599325 0-7 3.13400675-7 7 0 3.8659932 3.13400675 7 7 7 3.8659932 0 7-3.1340068 7-7 0-1.85651543-.7374979-3.63699282-2.0502525-4.94974747-1.3127547-1.31275465-3.09323207-2.05025253-4.9497475-2.05025253zm0 13c-3.3137085 0-6-2.6862915-6-6s2.6862915-6 6-6 6 2.6862915 6 6c0 1.59129894-.632141 3.1174224-1.7573593 4.2426407s-2.65134176 1.7573593-4.2426407 1.7573593z",fill:"currentColor",fillRule:"evenodd"})),re=({color:e})=>l.a.createElement("svg",{height:"16",viewBox:"0 0 16 16",width:"16",xmlns:"http://www.w3.org/2000/svg",color:e},l.a.createElement("path",{d:"m8 1c-.46686 0-.92352.04577-1.36559.13323l.19407.98099c.3785-.07488.77017-.11422 1.17152-.11422s.79302.03934 1.17152.11422l.19407-.98099c-.44207-.08746-.89873-.13323-1.36559-.13323zm-3.88966 1.17934c-.76315.51091-1.42009 1.16785-1.931 1.931l.83097.55632c.43819-.65453 1.00182-1.21816 1.65635-1.65635zm9.71036 1.931c-.511-.76315-1.1679-1.42009-1.931-1.931l-.5564.83097c.6546.43819 1.2182 1.00182 1.6564 1.65635zm1.1793 3.88966c0-.46686-.0458-.92352-.1332-1.36559l-.981.19407c.0749.3785.1142.77017.1142 1.17152s-.0393.79302-.1142 1.17152l.981.19407c.0874-.44207.1332-.89873.1332-1.36559zm-13.86677-1.36559c-.08746.44207-.13323.89873-.13323 1.36559s.04577.92352.13323 1.36559l.98099-.19407c-.07488-.3785-.11422-.77017-.11422-1.17152s.03934-.79302.11422-1.17152zm1.04611 5.25529c.51091.7631 1.16785 1.42 1.931 1.931l.55632-.831c-.65453-.4382-1.21816-1.0018-1.65635-1.6564zm9.71036 1.931c.7631-.511 1.42-1.1679 1.931-1.931l-.831-.5564c-.4382.6546-1.0018 1.2182-1.6564 1.6564zm-5.25529 1.0461c.44207.0874.89873.1332 1.36559.1332s.92352-.0458 1.36559-.1332l-.19407-.981c-.3785.0749-.77017.1142-1.17152.1142s-.79302-.0393-1.17152-.1142zm3.36559-6.8668c0 1.10457-.89543 2-2 2s-2-.89543-2-2 .89543-2 2-2 2 .89543 2 2zm1 0c0 1.65685-1.34315 3-3 3s-3-1.34315-3-3 1.34315-3 3-3 3 1.34315 3 3z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})),oe=({color:e})=>l.a.createElement("svg",{height:"16",viewBox:"0 0 16 16",width:"16",xmlns:"http://www.w3.org/2000/svg",color:e},l.a.createElement("path",{d:"M3 2H4H5H11H12H13V3H12V6.20711L10.2071 8L12 9.79289V13H13V14H12H11H5H4H3V13H4V9.79289L5.79289 8L4 6.20711V3H3V2ZM5 13H11V10.2071L8.79289 8L11 5.79289V3H5V5.79289L7.20711 8L5 10.2071V13Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})),le="UNAPPROVED_READY",ne="ACCEPTED_HERE",se="UNAPPROVED_WAITING",ie="UNAPPROVED_ABOVE",de="APPROVED_HERE",pe="APPROVED_ABOVE",ce="UNAPPROVABLE",ue="UNAUTHORIZED",me="LOADING",ve="ERROR",ye=({approvalStatus:e,approvalDateTime:t,approvedBy:a})=>{const o=(({approvalStatus:e,approvalDateTime:t,approvedBy:a})=>{switch(e){case le:return c.a.t("Ready for approval");case se:return c.a.t("Waiting for lower level approval");case ie:return c.a.t("Waiting for higher level approval");case ne:return c.a.t("Approval by {{- name}} accepted {{timeAgo}}",{name:a,timeAgo:te()(t).fromNow()});case de:return c.a.t("Approved by {{- name}} {{timeAgo}}",{name:a,timeAgo:te()(t).fromNow()});case pe:return c.a.t("Approved at higher level");case ue:return c.a.t("You do not have authority to approve data");case ce:return c.a.t("Cannot be approved");case ve:return c.a.t("Could not retrieve approval status");default:throw new Error(`Unknown approval status: '${e}'`)}})({approvalStatus:e,approvalDateTime:t,approvedBy:a}),{icon:l,type:n}=(e=>{switch(e){case le:return{icon:re,type:"neutral"};case se:case ie:return{icon:oe,type:"default"};case ne:case de:case pe:return{icon:ae,type:"positive"};case ce:case ue:return{icon:r.q,type:"negative"};case ve:return{icon:r.u,type:"negative"};default:throw new Error(`Unknown approval status: '${e}'`)}})(e);return{displayName:o,icon:l,type:n}},fe=36e5;function ge(){return(ge=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const we=({approvalStatus:e,approvedAt:t,approvedBy:a})=>{const o=t&&(e=>{const{systemInfo:t}=Object(s.e)(),a=new Date,r=new Date(a.toLocaleString("en-US",{timeZone:t.serverTimeZoneId})),o=new Date(e).getTime(),l=a.getTime()-r.getTime(),n=Math.round(l/fe)*fe;return new Date(o+n)})(t),{icon:n,displayName:i,type:d}=ye({approvalStatus:e,approvalDateTime:o,approvedBy:a}),p={[d]:!0,icon:l.a.createElement(n,null)},u=(e=>e===de||e===pe)(e)&&t,m=l.a.createElement(r.L,ge({},p,{maxWidth:"auto"}),i);if(!u)return m;const v=te()(o).format("LLL"),y=c.a.t("Approved {{- dateTimeStr}}",{dateTimeStr:v});return l.a.createElement(r.M,{content:y},m)};var he=a(640),Ee=a.n(he);const be=e=>{switch(e){case"default":return r.N.grey500;case"neutral":return r.N.blue700;case"positive":return r.N.green600;case"negative":return r.N.red600}},Se=({approvalStatus:e,showTitle:t})=>{const{icon:a,displayName:r,type:o}=ye({approvalStatus:e});return l.a.createElement("span",{title:t?r:"",className:Ee.a.container},l.a.createElement(a,{color:be(o)}))};Se.defaultProps={showTitle:!0};var De=a(641),_e=a.n(De);const Ne=({onClick:e,children:t})=>l.a.createElement("button",{className:_e.a.button,onClick:e},t),ke={me:{resource:"me",params:{fields:["authorities","organisationUnits[id,path]"]}},dataApprovalWorkflows:{resource:"dataApprovalWorkflows",params:{paging:!1,fields:["id","displayName","dataApprovalLevels","periodType","dataSets[id,displayName,periodType]"]}}},Ae=({children:e})=>{const{data:t,fetching:a,error:o}=Object(s.h)(ke);if(a)return l.a.createElement(r.x,null,l.a.createElement(X,null));if(o)throw o;const{authorities:i,organisationUnits:d}=t.me,{dataApprovalWorkflows:p}=t.dataApprovalWorkflows,c={authorities:i,organisationUnits:d,dataApprovalWorkflows:p};return l.a.createElement(n.Provider,{value:c},e)},Ce=()=>Object(o.useContext)(n),$e=()=>{const{authorities:e}=Ce();return{hasAppAccess:e.some((e=>"ALL"===e||"M_dhis-web-approval"===e)),hasApprovalAuthorities:e.some((e=>"ALL"===e||"F_APPROVE_DATA"===e||"F_APPROVE_DATA_LOWER_LEVELS"===e||"F_ACCEPT_DATA_LOWER_LEVELS"===e))}},Oe=({children:e})=>{const{hasAppAccess:t}=$e();return t?e:l.a.createElement(p,{title:c.a.t("Not authorized")},c.a.t("You don't have access to the Data Approval App. Contact a system administrator to request access."))},Te=Object(o.createContext)({approvalStatus:"",allowedActions:{},refresh:()=>{throw new Error("WorkflowContext.refresh has not been initialized")}}),Fe=()=>{throw new Error("Selection Context has not been initialized")},xe=Object(o.createContext)({workflow:{},period:{},orgUnit:{},selectWorkflow:Fe,selectPeriod:Fe,selectOrgUnit:Fe,clearAll:Fe,setOpenedSelect:Fe});var Pe=a(638);const We=e=>`/#/?${Object(Pe.stringify)(e)}`;var Ie=a(646);const Ue=Object(Ie.a)(),Ye=e=>{const t=(()=>{const e=Object(Pe.parse)(Ue.location.search);return{wf:e.wf,pe:e.pe,ou:e.ou,ouDisplayName:e.ouDisplayName,dataSet:e.dataSet}})(),{wf:a,pe:r,ou:o,ouDisplayName:l,dataSet:n}=t,s=je(e,a);return{workflow:s,period:Me(r,s),orgUnit:Re(o,l),dataSet:Le(n)}},je=(e,t)=>1===e.length?e[0]:t&&e.find((e=>e.id===t))||null,Me=(e,t={})=>e&&t.id?((e,t)=>{const a=t?q().filter((({type:e})=>t.some((t=>t===e)))):q();let r,o,l=0;for(;l<a.length&&!o;)r=a[l],o=e.match(r.regex),l++;if(!o)return null;const n=parseInt(o[1],10),s=Z(n);return{...r.getPeriods({offset:s}).find((t=>t.id===e)),year:n,periodType:r}})(e,[t.periodType]):null,Re=(e,t)=>{if(!e||!t)return null;const[a]=e.match(/[/]?[^/]*$/);return{id:a.replace("/",""),path:e,displayName:t}},Le=e=>e||null,Be="SET_OPENED_SELECT",Ve="CLEAR_ALL",He="SELECT_WORKFLOW",Je="SELECT_PERIOD",ze="SELECT_ORG_UNIT",qe="SELECT_DATA_SET",Ze="SET_STATE_FROM_QUERY_PARAMS",Qe=(e,{type:t,payload:a})=>{var r,o,l;switch(t){case Be:return{...e,openedSelect:a.openedSelect};case Ve:return{openedSelect:"",workflow:a.workflow,period:null,orgUnit:null,dataSet:null};case He:return{...e,openedSelect:"",workflow:a.workflow,period:e.workflow&&(null===(r=e.workflow)||void 0===r?void 0:r.periodType)===(null===(o=a.workflow)||void 0===o?void 0:o.periodType)?e.period:null,dataSet:null};case Je:return{...e,openedSelect:null!==(l=a.period)&&void 0!==l&&l.id?"":e.openedSelect,period:a.period,dataSet:null};case ze:return{...e,openedSelect:"",orgUnit:a.orgUnit,dataSet:null};case qe:return{...e,dataSet:a.dataSet};case Ze:return{openedSelect:"",...Ye(a.dataApprovalWorkflows)};default:return e}},Ge=({children:e})=>{const{dataApprovalWorkflows:t}=Ce(),[{openedSelect:a,workflow:r,period:n,orgUnit:s,dataSet:i},d]=Object(o.useReducer)(Qe,{openedSelect:"",...Ye(t)}),p={workflow:r,period:n,orgUnit:s,openedSelect:a,dataSet:i,clearAll:()=>d({type:Ve,payload:{workflow:je(t)}}),setOpenedSelect:e=>d({type:Be,payload:{openedSelect:e}}),selectWorkflow:e=>d({type:He,payload:{workflow:e}}),selectPeriod:e=>d({type:Je,payload:{period:e}}),selectOrgUnit:e=>d({type:ze,payload:{orgUnit:e}}),selectDataSet:e=>d({type:qe,payload:{dataSet:e}})};return Object(o.useEffect)((()=>{(e=>{var t,a,r,o;const l=Object(Pe.stringify)({wf:null===(t=e.workflow)||void 0===t?void 0:t.id,pe:null===(a=e.period)||void 0===a?void 0:a.id,ou:null===(r=e.orgUnit)||void 0===r?void 0:r.path,ouDisplayName:null===(o=e.orgUnit)||void 0===o?void 0:o.displayName,dataSet:e.dataSet||void 0}),n=l?`?${l}`:"";n!==Ue.location.search&&Ue.push({pathname:"/",search:n})})({workflow:r,period:n,orgUnit:s,dataSet:i})}),[r,n,s,i]),Object(o.useEffect)((()=>{const e=()=>{d({type:Ze,payload:{dataApprovalWorkflows:t}})};return window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}}),[]),l.a.createElement(xe.Provider,{value:p},e)},Ke=()=>Object(o.useContext)(xe),Xe={approvalStatus:{resource:"dataApprovals",params:({workflow:e,period:t,orgUnit:a})=>({wf:e.id,pe:t.id,ou:a.id})}},et=({children:e})=>{const{workflow:t,period:a,orgUnit:r}=Ke(),{fetching:n,error:i,data:d,called:u,refetch:m}=Object(s.h)(Xe,{lazy:!0}),v=()=>m({workflow:t,period:a,orgUnit:r});if(Object(o.useEffect)((()=>{t&&a&&r&&v()}),[t,a,r]),!t||!a||!r)return null;if(n||!u)return l.a.createElement(X,null);if(i)return l.a.createElement(p,{title:c.a.t("Could not load approval data")},l.a.createElement("p",null,i.message),l.a.createElement(Ne,{onClick:v},c.a.t("Retry loading approval data")));const{state:y,approvedBy:f,approvedAt:g,...w}=d.approvalStatus;return l.a.createElement(Te.Provider,{value:{approvalStatus:y,approvedBy:f,approvedAt:g,allowedActions:w,refresh:m,params:{wf:t.id,pe:a.id,ou:r.id}}},e)},tt=()=>Object(o.useContext)(Te),at={resource:"dataAcceptances",type:"create",params:({wf:e,pe:t,ou:a})=>({wf:e,pe:t,ou:a})},rt=()=>{const[e,{loading:t,error:a}]=Object(s.g)(at),{params:n,refresh:i}=tt(),{show:d}=Object(s.c)(c.a.t("Acceptance failed: {{error}}",{error:a?a.toString():"",nsSeparator:"-:-"}));return Object(o.useEffect)((()=>{null!==a&&void 0!==a&&a.message&&d()}),[null===a||void 0===a?void 0:a.message]),l.a.createElement(r.c,{small:!0,disabled:t,onClick:async()=>{const{wf:t,pe:a,ou:r}=n;await e({wf:t,pe:a,ou:r}),i()}},c.a.t("Accept"))};var ot=a(647),lt=a.n(ot);const nt=({onApprove:e,onCancel:t,error:a})=>{const{workflow:o}=Ke(),{dataSets:n}=o,s=n.length;return l.a.createElement(r.A,null,l.a.createElement(r.D,null,s>1?c.a.t("Approving {{count}} data sets",{count:s}):c.a.t("Approving {{count}} data set",{count:s})),l.a.createElement(r.C,null,l.a.createElement("div",{className:lt.a.summary},l.a.createElement("h1",{className:lt.a.summaryTitle},s>1?c.a.t("{{count}} data sets for workflow {{- workflow}}:",{count:s,workflow:o.displayName}):c.a.t("{{count}} data set for workflow {{- workflow}}:",{count:s,workflow:o.displayName})),l.a.createElement("ul",{className:lt.a.summaryList},n.map((({id:e,displayName:t})=>l.a.createElement("li",{className:lt.a.summaryListItem,key:e},t))))),l.a.createElement("p",{className:lt.a.confirmationStatement},c.a.t("Are you sure you want to approve this data?")),a&&l.a.createElement(r.E,{error:!0,title:c.a.t("There was a problem saving this approval")},c.a.t("This data couldn\u2019t be approved. Try again, or contact your system administrator."))),l.a.createElement(r.B,null,l.a.createElement(r.d,null,l.a.createElement(r.c,{onClick:t},c.a.t("Cancel")),l.a.createElement(r.c,{primary:!0,onClick:e},c.a.t("Approve")))))},st={resource:"dataApprovals",type:"create",params:({wf:e,pe:t,ou:a})=>({wf:e,pe:t,ou:a})},it=({disabled:e})=>{const[t,a]=Object(o.useState)(null),[n,i]=Object(o.useState)(!1),{params:d,refresh:p}=tt(),u=()=>i(!1),{show:m}=Object(s.c)(c.a.t("Approval saved"),{success:!0}),[v,{loading:y,error:f}]=(({onComplete:e,onError:t})=>Object(s.g)(st,{onComplete:e,onError:t}))({onComplete:()=>{m(),u(),p()},onError:e=>a(e)}),g=f||t;return l.a.createElement(l.a.Fragment,null,l.a.createElement(r.c,{primary:!0,small:!0,disabled:e,onClick:()=>i(!0)},c.a.t("Approve")),n&&l.a.createElement(nt,{error:g,loading:y,onApprove:()=>{const{wf:e,pe:t,ou:a}=d;v({wf:e,pe:t,ou:a})},onCancel:u}))};var dt=a(648),pt=a.n(dt);const ct=({children:e})=>l.a.createElement("div",{className:pt.a.bottomBarItem},e);var ut=a(649),mt=a.n(ut);const vt={resource:"dataAcceptances",type:"delete",params:({wf:e,pe:t,ou:a})=>({wf:e,pe:t,ou:a})},yt=()=>{const[e,{loading:t,error:a}]=Object(s.g)(vt),{params:n,refresh:i}=tt(),{show:d}=Object(s.c)(c.a.t("Unacceptance failed: {{error}}",{error:a?a.toString():"",nsSeparator:"-:-"}));return Object(o.useEffect)((()=>{null!==a&&void 0!==a&&a.message&&d()}),[null===a||void 0===a?void 0:a.message]),l.a.createElement(r.c,{small:!0,disabled:t,onClick:async()=>{const{wf:t,pe:a,ou:r}=n;await e({wf:t,pe:a,ou:r}),i()}},c.a.t("Unaccept"))},ft={resource:"dataApprovals",type:"delete",params:({wf:e,pe:t,ou:a})=>({wf:e,pe:t,ou:a})},gt=()=>{const[e,{loading:t,error:a}]=Object(s.g)(ft),{params:n,refresh:i}=tt(),{show:d}=Object(s.c)(c.a.t("Unapproval failed: {{error}}",{error:a?a.toString():"",nsSeparator:"-:-"}));return Object(o.useEffect)((()=>{null!==a&&void 0!==a&&a.message&&d()}),[null===a||void 0===a?void 0:a.message]),l.a.createElement(r.c,{small:!0,disabled:t,onClick:async()=>{const{wf:t,pe:a,ou:r}=n;await e({wf:t,pe:a,ou:r}),i()}},c.a.t("Unapprove"))},wt=new Set([de,pe,ne]),ht=()=>{const{allowedActions:e,approvalStatus:t,approvedBy:a,approvedAt:r}=tt(),{hasApprovalAuthorities:o}=$e(),{mayAccept:n,mayApprove:s,mayUnaccept:i,mayUnapprove:d}=e,p=!s&&!d||s&&wt.has(t);return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:mt.a.bottomBar,"data-test":"bottom-bar"},l.a.createElement(ct,null,l.a.createElement(we,{approvalStatus:o?t:ue,approvedBy:a,approvedAt:r})),(s||p)&&l.a.createElement(ct,null,l.a.createElement(it,{disabled:p})),n&&l.a.createElement(ct,null,l.a.createElement(rt,null)),d&&l.a.createElement(ct,null,l.a.createElement(gt,null)),i&&l.a.createElement(ct,null,l.a.createElement(yt,null))))},Et=({dataSets:e,selected:t,onChange:a})=>e&&(null===e||void 0===e?void 0:e.length)>0?l.a.createElement(r.I,{scrollable:!0},e.map((e=>l.a.createElement(r.H,{key:e.id,onClick:()=>a(e.id),selected:e.id===t},e.displayName)))):null;var bt=a(650),St=a.n(bt),Dt=a(651),_t=a.n(Dt);const Nt=({children:e,columns:t})=>l.a.createElement("tr",null,l.a.createElement("th",{className:_t.a.titleCell,colSpan:t.toString()},e)),kt=({title:e,columns:t,rows:a})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(r.i,{className:_t.a.dataTable},l.a.createElement(r.K,null,l.a.createElement(Nt,{columns:t.length},e),l.a.createElement(r.l,null,l.a.createElement(r.k,{className:_t.a.cell},l.a.createElement("span",{className:_t.a.labelCellContent},t[0])),t.slice(1).map((e=>l.a.createElement(r.k,{key:e,className:_t.a.cell},e))))),l.a.createElement(r.J,null,a.map(((e,t)=>{const[a,...o]=e;return l.a.createElement(r.l,{key:t},l.a.createElement(r.j,{className:_t.a.cell},l.a.createElement("span",{className:_t.a.labelCellContent},a)),o.map(((e,t)=>l.a.createElement(r.j,{key:t,className:_t.a.cell},e))))}))))),At={dataSetReport:{resource:"dataSetReport",params:({dataSetId:e,periodIds:t,orgUnit:a})=>({pe:t,ds:e,ou:a.id})}},Ct=({dataSetId:e})=>{const t=Ke(),{orgUnit:a,workflow:n,period:i}=t,{dataSets:d}=n,p=d.find((({id:t})=>t===e)),u=p?K(p.periodType,i.startDate,i.endDate).map((({id:e})=>e)):[],{called:m,fetching:v,data:y,error:f,refetch:g}=Object(s.h)(At,{lazy:!0}),w=null===y||void 0===y?void 0:y.dataSetReport,h=()=>g({periodIds:u,dataSetId:e,orgUnit:a});return Object(o.useEffect)((()=>{u.length&&e&&h()}),[u.join(","),e]),d&&0!==d.length?e?!m&&u.length||v?l.a.createElement("div",{className:St.a.display},l.a.createElement("div",{className:St.a.loadingWrapper},l.a.createElement(r.f,{small:!0}),c.a.t("Loading data set"))):f?l.a.createElement("div",{className:St.a.display},l.a.createElement(r.E,{error:!0,title:c.a.t("There was a problem displaying this data set")},l.a.createElement("p",null,c.a.t("This data set couldn't be loaded or displayed. Try again, or contact your system administrator.")),l.a.createElement(Ne,{onClick:h},c.a.t("Retry loading data set")))):u.length&&w.length?l.a.createElement("div",{className:St.a.display},w.map((e=>l.a.createElement(kt,{key:e.title,title:e.title,columns:e.headers.map((e=>e.name)),rows:e.rows})))):l.a.createElement("div",{className:St.a.noData},l.a.createElement("p",null,c.a.t("This data set doesn't have any data for {{- period}} in {{- orgUnit}}.",{period:i.displayName,orgUnit:a.displayName}))):l.a.createElement("div",{className:St.a.chooseDataSet},l.a.createElement("h2",null,c.a.t("Choose a data set to review")),l.a.createElement("p",null,c.a.t("{{- workflowName}} has multiple data sets. Choose a data set from the tabs above.",{workflowName:n.displayName}))):l.a.createElement("div",{className:St.a.noData},l.a.createElement("p",null,c.a.t("This workflow does not contain any data sets.")))};var $t=a(652),Ot=a.n($t);const Tt=()=>{const{approvalStatus:e,approvedBy:t,approvedAt:a}=tt(),{workflow:o}=Ke(),{dataSets:n,displayName:s}=o,i=n.length;return l.a.createElement("div",{className:Ot.a.titleBar},l.a.createElement("span",{className:Ot.a.workflowName},s),l.a.createElement("span",{className:Ot.a.workflowDataSetsCount},l.a.createElement(r.t,null),1===i&&c.a.t("1 data set",{dataSetsCount:i}),1!==i&&c.a.t("{{dataSetsCount}} data sets",{dataSetsCount:i})),l.a.createElement(we,{approvalStatus:e,approvedBy:t,approvedAt:a}))},Ft=()=>{const{workflow:e,selectDataSet:t}=Ke(),a=(()=>{const{workflow:e,dataSet:t}=Ke();return Object(o.useMemo)((()=>{if(1===e.dataSets.length)return e.dataSets[0].id;if(t){const a=e.dataSets.find((({id:e})=>e===t));return null===a||void 0===a?void 0:a.id}return null}),[e,t])})();return l.a.createElement(l.a.Fragment,null,l.a.createElement(Tt,null),l.a.createElement(Et,{dataSets:null===e||void 0===e?void 0:e.dataSets,selected:a,onChange:t}),l.a.createElement(Ct,{dataSetId:a}))};var xt=a(653),Pt=a.n(xt);const Wt=()=>{const{clearAll:e,period:t,orgUnit:a}=Ke();return null!==t&&void 0!==t&&t.id||null!==a&&void 0!==a&&a.path?l.a.createElement(r.c,{small:!0,className:Pt.a.button,secondary:!0,onClick:e},c.a.t("Clear selections")):null};var It=a(665);const Ut=Object(o.createContext)();class Yt{constructor(e){this._map=e||new Map}_serialiseKey({workflowId:e,periodId:t,orgUnitId:a}){return`${e}-${t}-${a}`}set(e,t){this._map.set(this._serialiseKey(e),t)}get(e){return this._map.get(this._serialiseKey(e))}clone(){return new Yt(new Map(this._map))}}const jt=({children:e})=>{const[t,a]=Object(o.useState)(new Yt),r=(({updateApprovalStatuses:e})=>{const t=Object(s.f)(),a=Object(o.useRef)([]),r=Object(It.a)((()=>{const r=[];a.current.forEach((e=>{const t=r.find((({workflowId:t,periodId:a})=>t===e.workflowId&&a===e.periodId));t?t.orgUnitIds.push(e.orgUnitId):r.push({workflowId:e.workflowId,periodId:e.periodId,orgUnitIds:[e.orgUnitId]})})),a.current=[],r.forEach((async({workflowId:a,periodId:r,orgUnitIds:o})=>{e({periodId:r,workflowId:a,approvalStatusUpdates:o.reduce(((e,t)=>(e[t]=me,e)),{})});const l={};try{const{approvalStatuses:e}=await t.query({approvalStatuses:{resource:"dataApprovals/approvals",params:{wf:a,pe:r,ou:o}}});e.forEach((({ou:e,state:t})=>{l[e]=t||ce}))}catch(n){o.forEach((e=>{l[e]=ve}))}e({periodId:r,workflowId:a,approvalStatusUpdates:l})}))}),10);return({workflowId:e,periodId:t,orgUnitId:o})=>{a.current.push({periodId:t,workflowId:e,orgUnitId:o}),r()}})({updateApprovalStatuses:({workflowId:e,periodId:t,approvalStatusUpdates:r})=>{a((a=>{const o=a.clone();for(const[l,n]of Object.entries(r))o.set({workflowId:e,periodId:t,orgUnitId:l},n);return o}))}});return l.a.createElement(Ut.Provider,{value:{approvalStatuses:t,fetchApprovalStatus:r}},e)},Mt=()=>{const{approvalStatuses:e,fetchApprovalStatus:t}=Object(o.useContext)(Ut);return{getApprovalStatus:({workflowId:t,periodId:a,orgUnitId:r})=>e.get({workflowId:t,periodId:a,orgUnitId:r}),fetchApprovalStatus:t}};var Rt=a(654),Lt=a.n(Rt);const Bt=({children:e,dataTest:t,prefix:a,placeholder:n,value:s,onClose:i,onOpen:d,disabled:p,open:c,requiredValuesMessage:u,popoverMaxWidth:m})=>{const v=Object(o.useRef)(),y=c?r.s:r.r,f=l.a.createElement("button",{ref:v,className:Lt.a.button,onClick:d,disabled:p,"data-test":`${t}-button`},l.a.createElement("span",{className:Lt.a.prefix},a),l.a.createElement("span",{className:Lt.a.value,"data-test":"value"},s||!p&&n),l.a.createElement(y,{color:p?r.N.grey600:void 0}));return l.a.createElement(l.a.Fragment,null,p?l.a.createElement(r.M,{content:u,placement:"bottom"},(({ref:e,onMouseOver:t,onMouseOut:a})=>l.a.createElement("div",{ref:e,onMouseOver:t,onMouseOut:a,className:Lt.a.tooltipwrap},f))):f,c&&l.a.createElement(r.G,{reference:v,arrow:!1,placement:"bottom-end",onClickOutside:i,maxWidth:m,dataTest:`${t}-popover`},e))};var Vt=a(655),Ht=a.n(Vt);const Jt=[{status:se,displayName:c.a.t("Waiting for approval")},{status:le,displayName:c.a.t("Ready for approval")},{status:de,displayName:c.a.t("Approved")},{status:ce,displayName:c.a.t("Cannot be approved")}],zt=()=>l.a.createElement("div",{className:Ht.a.container},Jt.map((({status:e,displayName:t})=>l.a.createElement("div",{key:e,className:Ht.a.label},l.a.createElement(Se,{approvalStatus:e,showTitle:!1}),t))));var qt=a(656),Zt=a.n(qt);const Qt=({label:e,orgUnitId:t})=>{const{workflow:a,period:n}=Ke(),{getApprovalStatus:s,fetchApprovalStatus:i}=Mt(),d=s({workflowId:a.id,periodId:n.id,orgUnitId:t});return Object(o.useEffect)((()=>{i({workflowId:a.id,periodId:n.id,orgUnitId:t})}),[]),l.a.createElement("div",{className:Zt.a.container},(e=>e===me?l.a.createElement("span",{className:Zt.a.loadingIcon}):e===ve?l.a.createElement(r.M,{content:c.a.t("Failed to load approval state")},(({onMouseOver:e,onMouseOut:t,ref:a})=>l.a.createElement("span",{className:Zt.a.iconContainer,onMouseOver:e,onMouseOut:t,ref:a},l.a.createElement(r.v,{color:r.N.yellow500})))):e?l.a.createElement(Se,{approvalStatus:e}):void 0)(d),e)};var Gt=a(657),Kt=a.n(Gt);const Xt="ORG_UNIT",ea=()=>{const{organisationUnits:e}=Ce(),{orgUnit:t,selectOrgUnit:a,workflow:o,period:n,openedSelect:s,setOpenedSelect:i}=Ke(),d=s===Xt,p=null===t||void 0===t?void 0:t.displayName,u=null!==o&&void 0!==o&&o.id?c.a.t("Choose a period first"):c.a.t("Choose a workflow and period first"),m=e.map((({id:e})=>e)),v=null!==t&&void 0!==t&&t.path?[t.path]:void 0,y=v||e.map((({path:e})=>e));return l.a.createElement(Bt,{dataTest:"org-unit-context-select",prefix:c.a.t("Organisation Unit"),placeholder:c.a.t("Choose an organisation unit"),value:p,open:d,disabled:!(null!==o&&void 0!==o&&o.id&&null!==n&&void 0!==n&&n.id),onOpen:()=>i(Xt),onClose:()=>i(""),requiredValuesMessage:u,popoverMaxWidth:400},l.a.createElement("div",{className:Kt.a.popoverContainer},l.a.createElement("div",{className:Kt.a.scrollbox},l.a.createElement(r.F,{roots:m,onChange:({displayName:e,id:t,path:r})=>{a({displayName:e,id:t,path:r})},initiallyExpanded:y,selected:v,singleSelection:!0,renderNodeLabel:({label:e,node:t})=>l.a.createElement(Qt,{label:e,orgUnitId:t.id})})),l.a.createElement(r.m,{margin:"0"}),l.a.createElement(zt,null)))};var ta=a(658),aa=a.n(ta);const ra=({periodType:e,year:t})=>{const{workflow:a,period:o,orgUnit:n,selectPeriod:i}=Ke(),{systemInfo:{dateFormat:d}}=Object(s.e)(),p=Q({periodType:e,year:t,formatYyyyMmDd:t=>"Daily"===e?te()(t).format(d.toUpperCase()):te()(t).format("YYYY-MM-DD"),config:{reversePeriods:!0}});return l.a.createElement(r.y,{dense:!0,className:aa.a.menu},p.map((e=>l.a.createElement(r.z,{active:e.id===(null===o||void 0===o?void 0:o.id),key:e.id,href:We({wf:null===a||void 0===a?void 0:a.id,ou:null===n||void 0===n?void 0:n.path,pe:e.id}),label:e.displayName,onClick:()=>i(e)}))))};var oa=a(659),la=a.n(oa);const na=({maxYear:e,year:t,onYearChange:a})=>l.a.createElement("div",{className:la.a.container},l.a.createElement(r.c,{disabled:1970===t,onClick:()=>a(t-1),icon:l.a.createElement(r.o,null)}),l.a.createElement("span",{className:la.a.year},t),l.a.createElement(r.c,{disabled:t===e,onClick:()=>a(t+1),icon:l.a.createElement(r.p,null)})),sa="PERIOD",ia=e=>e?(e=>{if(!O(e))throw new Error(`Invalid periodType "${e}" supplied to "getMostRecentCompletedYear"`);const t=F();let a=t.getFullYear(),r=K(e,`${t.getFullYear()}-01-01`,t);if(r.length>0)return a;for(;0===r.length;)--a,r=K(e,`${a}-01-01`,`${a}-12-31`);return a})(e):null,da=()=>{const{period:e,workflow:t,selectPeriod:a,openedSelect:r,setOpenedSelect:n}=Ke(),[s,i]=Object(o.useState)((()=>ia(null===t||void 0===t?void 0:t.periodType))),[d,p]=Object(o.useState)((null===e||void 0===e?void 0:e.year)||s),u=r===sa,m=null===e||void 0===e?void 0:e.displayName;return Object(o.useEffect)((()=>{null!==e&&void 0!==e&&e.year&&p(e.year)}),[null===e||void 0===e?void 0:e.year]),Object(o.useEffect)((()=>{if(null!==t&&void 0!==t&&t.periodType){const a=ia(null===t||void 0===t?void 0:t.periodType);i(a),null!==e&&void 0!==e&&e.year||p(a)}}),[null===t||void 0===t?void 0:t.periodType]),l.a.createElement(Bt,{dataTest:"period-context-select",prefix:c.a.t("Period"),placeholder:c.a.t("Choose a period"),value:m,open:u,disabled:!(null!==t&&void 0!==t&&t.id),onOpen:()=>n(sa),onClose:()=>n(""),requiredValuesMessage:c.a.t("Choose a workflow first")},d&&l.a.createElement(l.a.Fragment,null,l.a.createElement(na,{maxYear:s,year:d,onYearChange:e=>{a(null),p(e)}}),l.a.createElement(ra,{periodType:null===t||void 0===t?void 0:t.periodType,year:d})))};var pa=a(660),ca=a.n(pa);const ua=({id:e,name:t,periodType:a,active:o,onClick:n})=>{const s=l.a.createElement("div",{className:ca.a.option},l.a.createElement("span",{className:ca.a.title},t),l.a.createElement("span",{className:ca.a.subtitle},a||"UNAVAILABLE"));return l.a.createElement(r.z,{href:We({wf:e}),className:ca.a.bordered,active:o,onClick:n,label:s})};var ma=a(661),va=a.n(ma);const ya="WORKFLOW",fa=()=>{const{dataApprovalWorkflows:e}=Ce(),{workflow:t,selectWorkflow:a,openedSelect:o,setOpenedSelect:n}=Ke(),s=o===ya,i=null===t||void 0===t?void 0:t.displayName;return l.a.createElement(Bt,{dataTest:"workflow-context-select",prefix:c.a.t("Workflow"),placeholder:c.a.t("Choose a workflow"),value:i,open:s,onOpen:()=>n(ya),onClose:()=>n("")},0===e.length?l.a.createElement("div",{className:va.a.message},c.a.t("No workflows found. None may exist, or you may not have access to any.")):l.a.createElement(r.y,null,e.map((e=>l.a.createElement(ua,{key:e.id,id:e.id,name:e.displayName,periodType:e.periodType,active:e.id===(null===t||void 0===t?void 0:t.id),onClick:()=>a(e)})))))},ga=()=>l.a.createElement(l.a.Fragment,null,l.a.createElement(fa,null),l.a.createElement(da,null),l.a.createElement(jt,null,l.a.createElement(ea,null)),l.a.createElement(Wt,null));var wa=a(662),ha=a.n(wa);function Ea(){return(Ea=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const ba=({children:e,className:t})=>l.a.createElement("div",{className:t},e),Sa=e=>l.a.createElement(ba,Ea({},e,{className:ha.a.container})),Da=e=>l.a.createElement(ba,Ea({},e,{className:ha.a.top})),_a=e=>l.a.createElement(ba,Ea({},e,{className:ha.a.content})),Na=e=>l.a.createElement(ba,Ea({},e,{className:ha.a.bottom}));var ka=a(663);c.a.addResources("en","default",ka);c.a,t.default=()=>l.a.createElement(l.a.Fragment,null,l.a.createElement(r.h,{spacers:!0,colors:!0,theme:!0}),l.a.createElement(Ae,null,l.a.createElement(Oe,null,l.a.createElement(Ge,null,l.a.createElement(Sa,null,l.a.createElement(Da,null,l.a.createElement(ga,null)),l.a.createElement(et,null,l.a.createElement(_a,null,l.a.createElement(Ft,null)),l.a.createElement(Na,null,l.a.createElement(ht,null))))))))}}]);
//# sourceMappingURL=app.632fa6cd.chunk.js.map