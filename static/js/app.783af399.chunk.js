(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[135],{513:function(e,t,a){e.exports={wrapper:"auth-wall_wrapper__2MmQe"}},514:function(e,t,a){e.exports={button:"context-select_button__1y8va",prefix:"context-select_prefix__3xDFu",value:"context-select_value__oltZj",tooltipwrap:"context-select_tooltipwrap__3Fqbe"}},515:function(e,t,a){e.exports={menu:"period-menu_menu__2CHPS"}},516:function(e,t,a){e.exports={container:"year-navigator_container__3XXd2",year:"year-navigator_year__14nbM"}},517:function(e,t,a){e.exports={button:"clear-all-button_button__mDEHm"}},518:function(e,t,a){e.exports={bordered:"workflow-select-option_bordered__JBAIX",option:"workflow-select-option_option__1cqTS",title:"workflow-select-option_title__3zrtv",subtitle:"workflow-select-option_subtitle__3yrup"}},519:function(e,t,a){e.exports={message:"workflow-select_message__1jq5N"}},520:function(e,t,a){e.exports={container:"layout_container__Cp-96",top:"layout_top__2gcI9",content:"layout_content__10QOH",bottom:"layout_bottom__2toTd"}},521:function(e,t,a){"use strict";a.r(t);var r=a(6),l=a(0),o=a.n(l),n=a(508),s=a(4),i=a(513),c=a.n(i);const d=Object(l.createContext)({});var p=a(7);const u={me:{resource:"me",params:{fields:["id","authorities","programs","dataSets","userGroups","organisationUnits","dataViewOrganisationUnits"]}},dataApprovalWorkflows:{resource:"dataApprovalWorkflows",params:{paging:!1,fields:["id","displayName","dataApprovalLevels","periodType"]}}},m=({children:e})=>{const{data:t,loading:a,error:l}=Object(p.d)(u);if(a)return o.a.createElement(r.n,null,o.a.createElement(r.d,null,o.a.createElement(r.e,null)));if(l)throw l;const n={...t.me,...t.dataApprovalWorkflows};return o.a.createElement(d.Provider,{value:n},e)},g=()=>Object(l.useContext)(d),y=({children:e})=>(()=>{const{authorities:e}=g();return e.some((e=>"ALL"===e||"M_dhis-web-approval"===e))})()?e:o.a.createElement("div",{className:c.a.wrapper},o.a.createElement(r.u,{error:!0,title:s.a.t("Not authorized")},s.a.t("You don't have access to the Data Approval App. Contact a system administrator to request access."))),D=()=>o.a.createElement("pre",null,"BottomBar placeholder"),f=()=>o.a.createElement("pre",null,"DataWorkspace placeholder"),w=()=>{throw new Error("Selection Context has not been initialized")},$=Object(l.createContext)({workflow:{},setWorkflow:w,period:{},setPeriod:w,orgUnit:{},setOrgUnit:w});var h=a(514),v=a.n(h);const N=({children:e,prefix:t,value:a,onClose:n,onOpen:s,disabled:i,open:c,requiredValuesMessage:d})=>{const p=Object(l.useRef)(),u=c?r.l:r.k,m=o.a.createElement("button",{ref:p,className:v.a.button,onClick:s,disabled:i},o.a.createElement("span",{className:v.a.prefix},t),!i&&o.a.createElement("span",{className:v.a.value},a),o.a.createElement(u,{color:i?r.x.grey600:void 0}));return o.a.createElement(o.a.Fragment,null,i?o.a.createElement(r.w,{content:d,placement:"bottom"},(({ref:e,onMouseOver:t,onMouseOut:a})=>o.a.createElement("div",{ref:e,onMouseOver:t,onMouseOut:a,className:v.a.tooltipwrap},m))):m,c&&o.a.createElement(r.v,{reference:p,arrow:!1,placement:"bottom-start",onClickOutside:n},e))},E=e=>[s.a.t("January"),s.a.t("February"),s.a.t("March"),s.a.t("April"),s.a.t("May"),s.a.t("June"),s.a.t("July"),s.a.t("August"),s.a.t("September"),s.a.t("October"),s.a.t("November"),s.a.t("December")][e],F=(e,t,a)=>r=>{let l=[];const o=parseInt(r.offset,10),n=r.filterFuturePeriods,i=r.reversePeriods,c=new Date(Date.now()).getFullYear()+o,d=((e,t)=>{const a=new Date(e,0,4),r=a.getDay(),l=a,o=r-t;return o>0?l.setDate(a.getDate()-o):o<0&&(l.setDate(a.getDate()-o),l.setDate(l.getDate()-7)),l})(c,t.startDay);let p=1;for(;d.getFullYear()<=c;){const a={};a.startDate=e(d),a.iso=`${c}${t.shortName}W${p}`,a.id=a.iso,d.setDate(d.getDate()+6),a.endDate=e(d);const r=p;if(a.displayName=`${s.a.t("Week {{weekNumber}}",{weekNumber:r})} - ${a.startDate} - ${a.endDate}`,d.getFullYear()>c&&d.getDate()>=4)break;l.push(a),d.setDate(d.getDate()+1),p+=1}return l=n?a(l):l,l=i?l.reverse():l,l},b=(e,t)=>a=>{let r=[];const l=parseInt(a.offset,10),o=a.filterFuturePeriods,n=a.reversePeriods,i=new Date(Date.now()).getFullYear()+l,c=new Date(`01 Jan ${i}`),d=c.getDay();let p=1;for(d<=4?c.setDate(c.getDate()-(d-1)):c.setDate(c.getDate()+(8-d));c.getFullYear()<=i;){const t={};t.iso=`${i}BiW${p}`,t.id=t.iso,t.startDate=e(c),c.setDate(c.getDate()+13),t.endDate=e(c);const a=p;if(t.displayName=`${s.a.t("Bi-Week {{biWeekNumber}}",{biWeekNumber:a})} - ${t.startDate} - ${t.endDate}`,c.getFullYear()>i&&c.getDate()>=4)break;r.push(t),c.setDate(c.getDate()+1),p+=1}return r=o?t(r):r,r=n?r.reverse():r,r},k=(e,t)=>{const a=e=>{const t=e.getFullYear();let a=String(e.getMonth()+1);return a=a.length<2?`0${a}`:a,t+a};return r=>{let l=[];const o=parseInt(r.offset,10),n=r.filterFuturePeriods,s=r.reversePeriods,i=new Date(Date.now()).getFullYear()+o,c=new Date(`31 Dec ${i}`);for(;c.getFullYear()===i;){const t={};t.endDate=e(c),c.setDate(1),t.startDate=e(c);const r=E(c.getMonth());t.displayName=`${r} ${i}`,t.iso=a(c),t.id=t.iso,l.push(t),c.setDate(0)}return l=n?t(l):l,l=s?l:l.reverse(),l}},_=(e,t)=>a=>{let r=[];const l=parseInt(a.offset,10),o=a.filterFuturePeriods,n=a.reversePeriods,s=new Date(Date.now()).getFullYear()+l,i=new Date(`31 Dec ${s}`);let c=6;for(;i.getFullYear()===s;){const t={};t.endDate=e(i),i.setDate(0),i.setDate(1),t.startDate=e(i);const a=E(i.getMonth()),l=E(i.getMonth()+1),o=i.getFullYear();t.displayName=`${a} - ${l} ${o}`,t.iso=`${s}0${c}B`,t.id=t.iso,r.push(t),i.setDate(0),c--}return r=o?t(r):r,r=n?r:r.reverse(),r},S=(e,t)=>a=>{let r=[];const l=parseInt(a.offset,10),o=a.filterFuturePeriods,n=a.reversePeriods,s=new Date(Date.now()).getFullYear()+l,i=new Date(`31 Dec ${s}`);let c=4;for(;i.getFullYear()===s;){const t={};t.endDate=e(i),i.setDate(0),i.setDate(0),i.setDate(1),t.startDate=e(i);const a=E(i.getMonth()),l=E(i.getMonth()+2),o=i.getFullYear();t.displayName=`${a} - ${l} ${o}`,t.iso=`${s}Q${c}`,t.id=t.iso,r.push(t),i.setDate(0),c-=1}return r=o?t(r):r,r=n?r:r.reverse(),r},P=e=>t=>{let a=[];const r=parseInt(t.offset,10),l=t.filterFuturePeriods,o=t.reversePeriods,n=new Date(Date.now()).getFullYear()+r;let s={};return s.startDate=`${n}-01-01`,s.endDate=`${n}-06-30`,s.displayName=`${E(0)} - ${E(5)} ${n}`,s.iso=`${n}S1`,s.id=s.iso,a.push(s),s={},s.startDate=`${n}-07-01`,s.endDate=`${n}-12-31`,s.displayName=`${E(6)} - ${E(11)} ${n}`,s.iso=`${n}S2`,s.id=s.iso,a.push(s),a=l?e(a):a,a=o?a.reverse():a,a},Y=e=>t=>{let a=[];const r=parseInt(t.offset,10),l=t.filterFuturePeriods,o=t.reversePeriods,n=new Date(Date.now()).getFullYear()+r;let s={};return s.startDate=`${n}-04-01`,s.endDate=`${n}-09-30`,s.displayName=`${E(3)} - ${E(8)} ${n}`,s.iso=`${n}AprilS1`,s.id=s.iso,a.push(s),s={},s.startDate=`${n}-10-01`,s.endDate=`${n+1}-03-31`,s.displayName=`${E(9)} ${n} - ${E(2)} ${n+1}`,s.iso=`${n}AprilS2`,s.id=s.iso,a.push(s),a=l?e(a):a,a=o?a.reverse():a,a},x=(e,t)=>a=>{let r=[];const l=parseInt(a.offset,10),o=a.filterFuturePeriods,n=a.reversePeriods,s=new Date(Date.now()).getFullYear()+l,i=new Date(`31 Dec ${s}`);for(;s-i.getFullYear()<10;){const t={};t.endDate=e(i),i.setMonth(0,1),t.startDate=e(i);const a=i.getFullYear().toString();t.displayName=a,t.iso=i.getFullYear().toString(),t.id=t.iso.toString(),r.push(t),i.setDate(0)}return r=o?t(r):r,r=n?r:r.reverse(),r},O=(e,t)=>a=>{let r=[];const l=parseInt(a.offset,10),o=a.filterFuturePeriods,n=a.reversePeriods,s=new Date(Date.now()).getFullYear()+l,i=new Date(`30 Sep ${s+1}`);for(let t=0;t<10;t++){const t={};t.endDate=e(i),i.setYear(i.getFullYear()-1),i.setDate(i.getDate()+1),t.startDate=e(i);const a=i.getFullYear(),l=i.getFullYear()+1;t.displayName=`${E(9)} ${a} - ${E(8)} ${l}`,t.id=`${i.getFullYear()}Oct`,r.push(t),i.setDate(i.getDate()-1)}return r=o?t(r):r,r=n?r:r.reverse(),r},W=(e,t)=>a=>{let r=[];const l=parseInt(a.offset,10),o=a.filterFuturePeriods,n=a.reversePeriods,s=new Date(Date.now()).getFullYear()+l,i=new Date(`31 Oct ${s+1}`);for(let t=0;t<10;t++){const t={};t.endDate=e(i),i.setYear(i.getFullYear()-1),i.setDate(i.getDate()+1),t.startDate=e(i);const a=i.getFullYear(),l=i.getFullYear()+1;t.displayName=`${E(10)} ${a} - ${E(9)} ${l}`,t.id=`${i.getFullYear()}Nov`,r.push(t),i.setDate(i.getDate()-1)}return r=o?t(r):r,r=n?r:r.reverse(),r},C=(e,t)=>a=>{let r=[];const l=parseInt(a.offset,10),o=a.filterFuturePeriods,n=a.reversePeriods,s=new Date(Date.now()).getFullYear()+l,i=new Date(`30 Jun ${s+1}`);for(let t=0;t<10;t++){const t={};t.endDate=e(i),i.setYear(i.getFullYear()-1),i.setDate(i.getDate()+1),t.startDate=e(i);const a=i.getFullYear(),l=i.getFullYear()+1;t.displayName=`${E(6)} ${a} - ${E(5)} ${l}`,t.id=`${i.getFullYear()}July`,r.push(t),i.setDate(i.getDate()-1)}return r=o?t(r):r,r=n?r:r.reverse(),r},A=(e,t)=>a=>{let r=[];const l=parseInt(a.offset,10),o=a.filterFuturePeriods,n=a.reversePeriods,s=new Date(Date.now()).getFullYear()+l,i=new Date(`31 Mar ${s+1}`);for(let t=0;t<10;t++){const t={};t.endDate=e(i),i.setYear(i.getFullYear()-1),i.setDate(i.getDate()+1),t.startDate=e(i);const a=i.getFullYear(),l=i.getFullYear()+1;t.displayName=`${E(3)} ${a} - ${E(2)} ${l}`,t.id=`${i.getFullYear()}April`,r.push(t),i.setDate(i.getDate()-1)}return r=o?t(r):r,r=n?r:r.reverse(),r},M=e=>{const t=e.getFullYear();let a=String(e.getMonth()+1),r=String(e.getDate());return a=a.length<2?`0${a}`:a,r=r.length<2?`0${r}`:r,`${t}-${a}-${r}`},I=e=>{const t=[],a=new Date(Date.now());for(let r=0;r<e.length;r++)new Date(e[r].startDate)<=a&&t.push(e[r]);return t},T=()=>{return[{type:"Daily",regex:/^([0-9]{4})([0-9]{2})([0-9]{2})$/,getPeriods:(e=M,t=I,a=>{let r=[];const l=parseInt(a.offset,10),o=a.filterFuturePeriods,n=a.reversePeriods,s=new Date(Date.now()).getFullYear()+l,i=new Date(`01 Jan ${s}`);for(;i.getFullYear()===s;){const t={};t.startDate=e(i),t.endDate=t.startDate,t.displayName=t.startDate,t.iso=t.startDate.replace(/-/g,""),t.id=t.iso,r.push(t),i.setDate(i.getDate()+1)}return r=o?t(r):r,r=n?r.reverse():r,r}),displayName:s.a.t("Daily")},{type:"Weekly",regex:/^([0-9]{4})()W([0-9]{1,2})$/,getPeriods:F(M,{shortName:"",startDay:1},I),displayName:s.a.t("Weekly")},{type:"WeeklyWednesday",regex:/^([0-9]{4})(Wed)W([0-9]{1,2})$/,getPeriods:F(M,{shortName:"Wed",startDay:3},I),displayName:s.a.t("Weekly (Start Wednesday)")},{type:"WeeklyThursday",regex:/^([0-9]{4})(Thu)W([0-9]{1,2})$/,getPeriods:F(M,{shortName:"Thu",startDay:4},I),displayName:s.a.t("Weekly (Start Thursday)")},{type:"WeeklySaturday",regex:/^([0-9]{4})(Sat)W([0-9]{1,2})$/,getPeriods:F(M,{shortName:"Sat",startDay:6},I),displayName:s.a.t("Weekly (Start Saturday)")},{type:"WeeklySunday",regex:/^([0-9]{4})(Sun)W([0-9]{1,2})$/,getPeriods:F(M,{shortName:"Sun",startDay:7},I),displayName:s.a.t("Weekly (Start Sunday)")},{type:"BiWeekly",regex:/^([0-9]{4})BiW([0-9]{1,2})$/,getPeriods:b(M,I),displayName:s.a.t("Bi-weekly")},{type:"Monthly",regex:/^([0-9]{4})([0-9]{2})$/,getPeriods:k(M,I),displayName:s.a.t("Monthly")},{type:"BiMonthly",regex:/^([0-9]{4})([0-9]{2})B$/,getPeriods:_(M,I),displayName:s.a.t("Bi-monthly")},{type:"Quarterly",regex:/^([0-9]{4})Q([1234])$/,getPeriods:S(M,I),displayName:s.a.t("Quarterly")},{type:"SixMonthly",regex:/^([0-9]{4})S([12])$/,getPeriods:P(I),displayName:s.a.t("Six-monthly")},{type:"SixMonthlyApril",regex:/^([0-9]{4})AprilS([12])$/,getPeriods:Y(I),displayName:s.a.t("Six-monthly April")},{type:"Yearly",regex:/^([0-9]{4})$/,getPeriods:x(M,I),displayName:s.a.t("Yearly")},{type:"FinancialNov",regex:/^([0-9]{4})Nov$/,getPeriods:W(M,I),displayName:s.a.t("Financial year (Start November)")},{type:"FinancialOct",regex:/^([0-9]{4})Oct$/,getPeriods:O(M,I),displayName:s.a.t("Financial year (Start October)")},{type:"FinancialJuly",regex:/^([0-9]{4})July$/,getPeriods:C(M,I),displayName:s.a.t("Financial year (Start July)")},{type:"FinancialApril",regex:/^([0-9]{4})April$/,getPeriods:A(M,I),displayName:s.a.t("Financial year (Start April)")}];var e,t},U=e=>e-new Date(Date.now()).getFullYear(),j=(e,t)=>{const a=(e=>T().find((t=>t.type===e)))(e),r=U(t);return a&&Number.isInteger(r)?a.getPeriods({offset:r}):void 0};var L=a(515),B=a.n(L);const J=({periodType:e,year:t})=>{const{selectPeriod:a}=ie(),l=j(e,t);return l?o.a.createElement(r.o,{dense:!0,className:B.a.menu},l.map((e=>o.a.createElement(r.p,{key:e.id,label:e.displayName,onClick:()=>a(e)})))):null};var R=a(516),q=a.n(R);const Q=(new Date).getFullYear(),V=new Date(0).getFullYear(),z=({year:e,onYearChange:t})=>o.a.createElement("div",{className:q.a.container},o.a.createElement(r.c,{disabled:e===V,onClick:()=>t(e-1),icon:o.a.createElement(r.i,null)}),o.a.createElement("span",{className:q.a.year},e),o.a.createElement(r.c,{disabled:e===Q,onClick:()=>t(e+1),icon:o.a.createElement(r.j,null)})),G="PERIOD",H=()=>{const{period:e,workflow:t,selectPeriod:a,openedSelect:r,setOpenedSelect:n}=ie(),[i,c]=Object(l.useState)(e.year||(new Date).getFullYear()),d=r===G,p=e.displayName||s.a.t("Choose a period");return Object(l.useEffect)((()=>{e.year&&c(e.year)}),[e]),o.a.createElement(N,{prefix:s.a.t("Period"),value:p,open:d,disabled:!t.id,onOpen:()=>n(G),onClose:()=>n(""),requiredValuesMessage:s.a.t("Choose a workflow first")},o.a.createElement(z,{year:i,onYearChange:e=>{a({}),c(e)}}),o.a.createElement(J,{periodType:t.periodType,year:i}))},X=(e,t)=>{const a=K(t,e.wf);return{workflow:a,period:Z(e.pe,a),orgUnit:ee(e.ou)}},K=(e,t)=>t?e.find((e=>e.id===t))||{}:1===e.length?e[0]:{},Z=(e,t)=>e&&t.id&&((e,t)=>{const a=t?T().filter((({type:e})=>t.some((t=>t===e)))):T();let r,l,o=0;for(;o<a.length&&!l;)r=a[o],l=e.match(r.regex),o++;if(!l)return;const n=parseInt(l[1]),s=U(n);return{...r.getPeriods({offset:s}).find((t=>t.id===e)),year:n,periodType:r}})(e,[t.periodType])||{},ee=e=>e?{id:e}:{},te="SET_OPENED_SELECT",ae="CLEAR_ALL",re="SELECT_WORKFLOW",le="SELECT_PERIOD",oe="SELECT_ORG_UNIT",ne=(e,{type:t,payload:a})=>{switch(t){case te:return{...e,openedSelect:a.openedSelect};case ae:case re:return{openedSelect:"",workflow:a.workflow,period:{},orgUnit:{}};case le:return{...e,openedSelect:a.period.id?"":e.openedSelect,period:a.period,orgUnit:{}};case oe:return{...e,openedSelect:"",orgUnit:a.orgUnit};default:return e}},se=({children:e})=>{const[t,a]=Object(n.c)({wf:n.b,pe:n.b,ou:n.b}),{dataApprovalWorkflows:r}=g(),[{openedSelect:s,workflow:i,period:c,orgUnit:d},p]=Object(l.useReducer)(ne,{openedSelect:"",...X(t,r)}),u={workflow:i,period:c,orgUnit:d,openedSelect:s,clearAll:()=>p({type:ae,payload:{workflow:K(r)}}),setOpenedSelect:e=>p({type:te,payload:{openedSelect:e}}),selectWorkflow:e=>p({type:re,payload:{workflow:e}}),selectPeriod:e=>p({type:le,payload:{period:e}}),selectOrgUnit:e=>p({type:oe,payload:{orgUnit:e}})};return Object(l.useEffect)((()=>{a({wf:i.id,pe:c.id,ou:d.id},"replace")}),[i,c,d]),o.a.createElement($.Provider,{value:u},e)},ie=()=>Object(l.useContext)($);var ce=a(517),de=a.n(ce);const pe=()=>{const{clearAll:e,period:t,orgUnit:a}=ie();return t.id||a.id?o.a.createElement(r.c,{className:de.a.button,secondary:!0,onClick:e},s.a.t("Clear selections")):null},ue="ORG_UNIT",me=()=>{const{orgUnit:e,workflow:t,period:a,openedSelect:r,setOpenedSelect:l}=ie(),n=r===ue,i=e.displayName||s.a.t("Choose an organisation unit"),c=t.id?s.a.t("Choose a period first"):s.a.t("Choose a workflow and period first");return o.a.createElement(N,{prefix:s.a.t("Organisation Unit"),value:i,open:n,disabled:!(t.id&&a.id),onOpen:()=>l(ue),onClose:()=>l(""),requiredValuesMessage:c},o.a.createElement("pre",null,"Org Unit picker placeholder"))};var ge=a(518),ye=a.n(ge);const De=({name:e,periodType:t,active:a,onClick:l})=>{const n=o.a.createElement("div",{className:ye.a.option},o.a.createElement("span",{className:ye.a.title},e),o.a.createElement("span",{className:ye.a.subtitle},t||"UNAVAILABLE"));return o.a.createElement(r.p,{className:ye.a.bordered,active:a,onClick:l,label:n})};var fe=a(519),we=a.n(fe);const $e="WORKFLOW",he=()=>{const{dataApprovalWorkflows:e}=g(),{workflow:t,selectWorkflow:a,openedSelect:l,setOpenedSelect:n}=ie(),i=l===$e,c=t.displayName||s.a.t("Choose a workflow");return o.a.createElement(N,{prefix:s.a.t("Workflow"),value:c,open:i,onOpen:()=>n($e),onClose:()=>n("")},0===e.length?o.a.createElement("div",{className:we.a.message},s.a.t("No workflows found. None may exist, or you may not have access to any.")):o.a.createElement(r.o,null,e.map((e=>o.a.createElement(De,{key:e.id,name:e.displayName,periodType:e.periodType,active:e.id===t.id,onClick:()=>a(e)})))))},ve=()=>o.a.createElement(se,null,o.a.createElement(he,null),o.a.createElement(H,null),o.a.createElement(me,null),o.a.createElement(pe,null));var Ne=a(520),Ee=a.n(Ne);function Fe(){return(Fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const be=({children:e,className:t})=>o.a.createElement("div",{className:t},e),ke=e=>o.a.createElement(be,Fe({},e,{className:Ee.a.container})),_e=e=>o.a.createElement(be,Fe({},e,{className:Ee.a.top})),Se=e=>o.a.createElement(be,Fe({},e,{className:Ee.a.content})),Pe=e=>o.a.createElement(be,Fe({},e,{className:Ee.a.bottom}));t.default=()=>o.a.createElement(n.a,null,o.a.createElement(r.g,{spacers:!0,colors:!0,theme:!0}),o.a.createElement(m,null,o.a.createElement(y,null,o.a.createElement(ke,null,o.a.createElement(_e,null,o.a.createElement(ve,null)),o.a.createElement(Se,null,o.a.createElement(f,null)),o.a.createElement(Pe,null,o.a.createElement(D,null))))))}}]);
//# sourceMappingURL=app.783af399.chunk.js.map