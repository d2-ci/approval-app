{"version":3,"sources":["D2App/app/layout.module.css","D2App/auth-wall/auth-wall.module.css","D2App/action-bar/action-bar.js","D2App/context-selector/context-selector.js","D2App/data-workspace/data-workspace.js","D2App/app/layout.js","D2App/cached-resources/cached-resources-context.js","D2App/cached-resources/cached-resources-provider.js","D2App/cached-resources/hooks.js","D2App/auth-wall/auth-wall.js","D2App/app/providers.js","D2App/app/index.js","D2App/app/app.js"],"names":["module","exports","ActionBar","React","createElement","ContextSelector","DataWorkspace","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","LayoutSection","children","className","Layout","props","classes","container","top","content","bottom","CachedResourcesContext","createContext","me","systemInfo","query","resource","params","fields","CachedResourcesProvider","data","loading","error","useDataQuery","Layer","CenteredContent","CircularLoader","providerValue","systemVersion","version","Provider","value","useIsAuthorized","authorities","useContext","some","authority","AuthWall","wrapper","NoticeBox","title","i18n","t","Providers","QueryParamProvider","CssVariables","spacers","colors","theme","App"],"mappings":"iHACAA,EAAOC,QAAU,CAAC,UAAY,0BAA0B,IAAM,oBAAoB,QAAU,wBAAwB,OAAS,yB,oBCA7HD,EAAOC,QAAU,CAAC,QAAU,6B,4DCC5B,MAAMC,EAAY,IAAmBC,IAAMC,cAAc,MAAO,KAAM,yBCAhEC,EAAkB,IAAmBF,IAAMC,cAAc,MAAO,KAAM,+BCAtEE,EAAgB,IAAmBH,IAAMC,cAAc,MAAO,KAAM,6B,sBCF1E,SAASG,IAA2Q,OAA9PA,EAAWC,OAAOC,QAAU,SAAUC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAII,KAAOD,EAAcN,OAAOQ,UAAUC,eAAeC,KAAKJ,EAAQC,KAAQL,EAAOK,GAAOD,EAAOC,IAAY,OAAOL,IAA2BS,MAAMC,KAAMR,WAMhT,MAAMS,EAAgB,EACpBC,WACAC,eACiBpB,IAAMC,cAAc,MAAO,CAC5CmB,UAAWA,GACVD,GAuBUE,EAhBKC,GAAsBtB,IAAMC,cAAciB,EAAed,EAAS,GAAIkB,EAAO,CAC7FF,UAAWG,IAAQC,aAeRH,EAZDC,GAAsBtB,IAAMC,cAAciB,EAAed,EAAS,GAAIkB,EAAO,CACvFF,UAAWG,IAAQE,OAWRJ,EARGC,GAAsBtB,IAAMC,cAAciB,EAAed,EAAS,GAAIkB,EAAO,CAC3FF,UAAWG,IAAQG,WAORL,EAJEC,GAAsBtB,IAAMC,cAAciB,EAAed,EAAS,GAAIkB,EAAO,CAC1FF,UAAWG,IAAQI,U,kCC9BrB,MAAMC,EAAsCC,wBAAc,CACxDC,GAAI,GACJC,WAAY,KCERC,EAAQ,CACZF,GAAI,CACFG,SAAU,KACVC,OAAQ,CACNC,OAAQ,CACR,cAAe,WAAY,WAAY,aAAc,oBAAqB,+BAG9EJ,WAAY,CACVE,SAAU,cACVC,OAAQ,CACNC,OAAQ,CAAC,cAKTC,EAA0B,EAC9BjB,eAEA,MAAM,KACJkB,EADI,QAEJC,EAFI,MAGJC,GACEC,YAAaR,GAEjB,GAAIM,EACF,OAAoBtC,IAAMC,cAAcwC,IAAO,KAAmBzC,IAAMC,cAAcyC,IAAiB,KAAmB1C,IAAMC,cAAc0C,IAAgB,QAGhK,GAAIJ,EAMF,MAAMA,EAIR,MAAMK,EAAgB,CACpBd,GAAIO,EAAKP,GACTe,cAAeR,EAAKN,WAAWe,SAEjC,OAAoB9C,IAAMC,cAAc2B,EAAuBmB,SAAU,CACvEC,MAAOJ,GACNzB,ICtCQ8B,EAAkB,KAC7B,MAAM,YACJC,GALYC,qBAAWvB,GACZE,GAMb,OAAOoB,EAAYE,MAAKC,GAA2B,QAAdA,GAAqC,wBAAdA,K,sBCT9D,MAAMC,EAAW,EACfnC,cAEqB8B,IAWd9B,EARenB,IAAMC,cAAc,MAAO,CAC7CmB,UAAWG,IAAQgC,SACLvD,IAAMC,cAAcuD,IAAW,CAC7CjB,OAAO,EACPkB,MAAOC,IAAKC,EAAE,mBACbD,IAAKC,EAAE,uGCZDC,EAAY,EACvBzC,cACiBnB,IAAMC,cAAc4D,IAAoB,KAAmB7D,IAAMC,cAAc6D,IAAc,CAC9GC,SAAS,EACTC,QAAQ,EACRC,OAAO,IACQjE,IAAMC,cAAcmC,EAAyB,KAAmBpC,IAAMC,cAAcqD,EAAU,KAAMnC,KCXtG+C,UCMH,IAAmBlE,IAAMC,cAAc2D,EAAW,KAAmB5D,IAAMC,cAAcoB,EAAkB,KAAmBrB,IAAMC,cAAcoB,EAAY,KAAmBrB,IAAMC,cAAcC,EAAiB,OAAqBF,IAAMC,cAAcoB,EAAgB,KAAmBrB,IAAMC,cAAcE,EAAe,OAAqBH,IAAMC,cAAcoB,EAAe,KAAmBrB,IAAMC,cAAcF,EAAW","file":"static/js/app.ef38e68a.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"layout_container__Cp-96\",\"top\":\"layout_top__2gcI9\",\"content\":\"layout_content__10QOH\",\"bottom\":\"layout_bottom__2toTd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"auth-wall_wrapper__7m--V\"};","import React from 'react';\n\nconst ActionBar = () => /*#__PURE__*/React.createElement(\"pre\", null, \"ActionBar placeholder\");\n\nexport { ActionBar };","import React from 'react';\n\nconst ContextSelector = () => /*#__PURE__*/React.createElement(\"pre\", null, \"ContextSelector placeholder\");\n\nexport { ContextSelector };","import React from 'react';\n\nconst DataWorkspace = () => /*#__PURE__*/React.createElement(\"pre\", null, \"DataWorkspace placeholder\");\n\nexport { DataWorkspace };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport classes from './layout.module.css';\n\nconst LayoutSection = ({\n  children,\n  className\n}) => /*#__PURE__*/React.createElement(\"div\", {\n  className: className\n}, children);\n\nLayoutSection.propTypes = {\n  children: PropTypes.node,\n  className: PropTypes.string\n};\n\nconst Container = props => /*#__PURE__*/React.createElement(LayoutSection, _extends({}, props, {\n  className: classes.container\n}));\n\nconst Top = props => /*#__PURE__*/React.createElement(LayoutSection, _extends({}, props, {\n  className: classes.top\n}));\n\nconst Content = props => /*#__PURE__*/React.createElement(LayoutSection, _extends({}, props, {\n  className: classes.content\n}));\n\nconst Bottom = props => /*#__PURE__*/React.createElement(LayoutSection, _extends({}, props, {\n  className: classes.bottom\n}));\n\nexport const Layout = {\n  Container,\n  Top,\n  Content,\n  Bottom\n};","import { createContext } from 'react';\nconst CachedResourcesContext = /*#__PURE__*/createContext({\n  me: {},\n  systemInfo: {}\n});\nexport { CachedResourcesContext };","import { useDataQuery } from '@dhis2/app-runtime';\nimport { PropTypes } from '@dhis2/prop-types';\nimport { CircularLoader, Layer, CenteredContent } from '@dhis2/ui';\nimport React from 'react';\nimport { CachedResourcesContext } from './cached-resources-context';\nconst query = {\n  me: {\n    resource: 'me',\n    params: {\n      fields: [// TODO: adjust fields according to actual requirements\n      'authorities', 'programs', 'dataSets', 'userGroups', 'organisationUnits', 'dataViewOrganisationUnits']\n    }\n  },\n  systemInfo: {\n    resource: 'system/info',\n    params: {\n      fields: ['version']\n    }\n  }\n};\n\nconst CachedResourcesProvider = ({\n  children\n}) => {\n  const {\n    data,\n    loading,\n    error\n  } = useDataQuery(query);\n\n  if (loading) {\n    return /*#__PURE__*/React.createElement(Layer, null, /*#__PURE__*/React.createElement(CenteredContent, null, /*#__PURE__*/React.createElement(CircularLoader, null)));\n  }\n\n  if (error) {\n    /**\n     * The app can't continue if this fails, because it doesn't\n     * have any data, so throw the error and let it be caught by\n     * the error boundary in the app-shell\n     */\n    throw error;\n  } // TODO: replace with some getters\n\n\n  const providerValue = {\n    me: data.me,\n    systemVersion: data.systemInfo.version\n  };\n  return /*#__PURE__*/React.createElement(CachedResourcesContext.Provider, {\n    value: providerValue\n  }, children);\n};\n\nCachedResourcesProvider.propTypes = {\n  children: PropTypes.node.isRequired\n};\nexport { CachedResourcesProvider };","import { useContext } from 'react';\nimport { CachedResourcesContext } from './cached-resources-context';\nexport const useSystemVersion = () => {\n  var _store$systemVersion;\n\n  const store = useContext(CachedResourcesContext);\n  return parseInt((_store$systemVersion = store.systemVersion) === null || _store$systemVersion === void 0 ? void 0 : _store$systemVersion.split(/\\.|-/)[1]);\n};\nexport const useCurrentUser = () => {\n  const store = useContext(CachedResourcesContext);\n  return store.me;\n};\nexport const useIsAuthorized = () => {\n  const {\n    authorities\n  } = useCurrentUser();\n  return authorities.some(authority => authority === 'ALL' || authority === 'M_dhis-web-approval');\n};","import i18n from '@dhis2/d2-i18n';\nimport { NoticeBox } from '@dhis2/ui';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { useIsAuthorized } from '../cached-resources';\nimport classes from './auth-wall.module.css';\n\nconst AuthWall = ({\n  children\n}) => {\n  const isAuthorized = useIsAuthorized();\n\n  if (!isAuthorized) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.wrapper\n    }, /*#__PURE__*/React.createElement(NoticeBox, {\n      error: true,\n      title: i18n.t('Not authorized')\n    }, i18n.t(\"You don't have access to the Data Approval App. Contact a system administrator to request access.\")));\n  }\n\n  return children;\n};\n\nAuthWall.propTypes = {\n  children: PropTypes.node.isRequired\n};\nexport { AuthWall };","import { CssVariables } from '@dhis2/ui';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { QueryParamProvider } from 'use-query-params';\nimport { AuthWall } from '../auth-wall';\nimport { CachedResourcesProvider } from '../cached-resources';\nexport const Providers = ({\n  children\n}) => /*#__PURE__*/React.createElement(QueryParamProvider, null, /*#__PURE__*/React.createElement(CssVariables, {\n  spacers: true,\n  colors: true,\n  theme: true\n}), /*#__PURE__*/React.createElement(CachedResourcesProvider, null, /*#__PURE__*/React.createElement(AuthWall, null, children)));\nProviders.propTypes = {\n  children: PropTypes.node\n};","import { App } from './app.js';\nexport default App;","import React from 'react';\nimport { ActionBar } from '../action-bar';\nimport { ContextSelector } from '../context-selector';\nimport { DataWorkspace } from '../data-workspace';\nimport { Layout } from './layout.js';\nimport { Providers } from './providers.js';\n\nconst App = () => /*#__PURE__*/React.createElement(Providers, null, /*#__PURE__*/React.createElement(Layout.Container, null, /*#__PURE__*/React.createElement(Layout.Top, null, /*#__PURE__*/React.createElement(ContextSelector, null)), /*#__PURE__*/React.createElement(Layout.Content, null, /*#__PURE__*/React.createElement(DataWorkspace, null)), /*#__PURE__*/React.createElement(Layout.Bottom, null, /*#__PURE__*/React.createElement(ActionBar, null))));\n\nexport { App };"],"sourceRoot":""}