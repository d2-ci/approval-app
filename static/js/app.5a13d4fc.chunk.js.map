{"version":3,"sources":["D2App/auth/auth-wall.module.css","D2App/app/layout.module.css","D2App/action-bar/action-bar.js","D2App/current-user/current-user-context.js","D2App/current-user/current-user-provider.js","D2App/auth/use-is-authorized.js","D2App/current-user/use-current-user.js","D2App/auth/auth-wall.js","D2App/context-selector/context-selector.js","D2App/data-workspace/data-workspace.js","D2App/app/layout.js","D2App/app/index.js","D2App/app/app.js"],"names":["module","exports","ActionBar","React","createElement","CurrentUserContext","createContext","meQuery","me","resource","params","fields","dataApprovalWorkflowsQuery","dataApprovalWorkflows","id","CurrentUserProvider","children","data","workflowsData","loading","workflowsLoading","error","workflowsError","refetch","refetchWorkflows","called","workflowsCalled","useDataQuery","lazy","meData","meLoading","meError","onComplete","Layer","CenteredContent","CircularLoader","Provider","value","useIsAuthorized","authorities","useContext","some","authority","AuthWall","className","classes","wrapper","NoticeBox","title","i18n","t","ContextSelector","DataWorkspace","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","LayoutSection","Layout","props","container","top","content","bottom","App","QueryParamProvider","CssVariables","spacers","colors","theme"],"mappings":"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","file":"static/js/app.5a13d4fc.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"auth-wall_wrapper__2MmQe\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"layout_container__Cp-96\",\"top\":\"layout_top__2gcI9\",\"content\":\"layout_content__10QOH\",\"bottom\":\"layout_bottom__2toTd\"};","import React from 'react';\n\nconst ActionBar = () => /*#__PURE__*/React.createElement(\"pre\", null, \"ActionBar placeholder\");\n\nexport { ActionBar };","import { createContext } from 'react';\nconst CurrentUserContext = /*#__PURE__*/createContext({});\nexport { CurrentUserContext };","import { useDataQuery } from '@dhis2/app-runtime';\nimport { PropTypes } from '@dhis2/prop-types';\nimport { CircularLoader, Layer, CenteredContent } from '@dhis2/ui';\nimport React from 'react';\nimport { CurrentUserContext } from './current-user-context';\nconst meQuery = {\n  me: {\n    resource: 'me',\n    params: {\n      fields: ['id', 'authorities', 'programs', 'dataSets', 'userGroups', 'organisationUnits', 'dataViewOrganisationUnits']\n    }\n  }\n};\nconst dataApprovalWorkflowsQuery = {\n  dataApprovalWorkflows: {\n    resource: 'users',\n    id: ({\n      id\n    }) => `${id}/dataApprovalWorkflows`\n  }\n};\n\nconst CurrentUserProvider = ({\n  children\n}) => {\n  const {\n    data: workflowsData,\n    loading: workflowsLoading,\n    error: workflowsError,\n    refetch: refetchWorkflows,\n    called: workflowsCalled\n  } = useDataQuery(dataApprovalWorkflowsQuery, {\n    lazy: true\n  });\n  const {\n    data: meData,\n    loading: meLoading,\n    error: meError\n  } = useDataQuery(meQuery, {\n    onComplete: ({\n      me: {\n        id\n      }\n    }) => refetchWorkflows({\n      id\n    })\n  });\n  const loading = !workflowsCalled || workflowsLoading || meLoading;\n  const error = !loading && (workflowsError || meError);\n\n  if (loading) {\n    return /*#__PURE__*/React.createElement(Layer, null, /*#__PURE__*/React.createElement(CenteredContent, null, /*#__PURE__*/React.createElement(CircularLoader, null)));\n  }\n\n  if (error) {\n    /**\n     * The app can't continue if this fails, because it doesn't\n     * have any data, so throw the error and let it be caught by\n     * the error boundary in the app-shell\n     */\n    throw error;\n  }\n\n  return /*#__PURE__*/React.createElement(CurrentUserContext.Provider, {\n    value: { ...meData.me,\n      ...workflowsData.dataApprovalWorkflows\n    }\n  }, children);\n};\n\nCurrentUserProvider.propTypes = {\n  children: PropTypes.node.isRequired\n};\nexport { CurrentUserProvider };","import { useCurrentUser } from '../current-user';\nexport const useIsAuthorized = () => {\n  const {\n    authorities\n  } = useCurrentUser();\n  return authorities.some(authority => authority === 'ALL' || authority === 'M_dhis-web-approval');\n};","import { useContext } from 'react';\nimport { CurrentUserContext } from './current-user-context';\nexport const useCurrentUser = () => useContext(CurrentUserContext);","import i18n from '@dhis2/d2-i18n';\nimport { NoticeBox } from '@dhis2/ui';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport classes from './auth-wall.module.css';\nimport { useIsAuthorized } from './use-is-authorized.js';\n\nconst AuthWall = ({\n  children\n}) => {\n  const isAuthorized = useIsAuthorized();\n\n  if (!isAuthorized) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.wrapper\n    }, /*#__PURE__*/React.createElement(NoticeBox, {\n      error: true,\n      title: i18n.t('Not authorized')\n    }, i18n.t(\"You don't have access to the Data Approval App. Contact a system administrator to request access.\")));\n  }\n\n  return children;\n};\n\nAuthWall.propTypes = {\n  children: PropTypes.node.isRequired\n};\nexport { AuthWall };","import React from 'react';\n\nconst ContextSelector = () => /*#__PURE__*/React.createElement(\"pre\", null, \"ContextSelector placeholder\");\n\nexport { ContextSelector };","import React from 'react';\n\nconst DataWorkspace = () => /*#__PURE__*/React.createElement(\"pre\", null, \"DataWorkspace placeholder\");\n\nexport { DataWorkspace };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport classes from './layout.module.css';\n\nconst LayoutSection = ({\n  children,\n  className\n}) => /*#__PURE__*/React.createElement(\"div\", {\n  className: className\n}, children);\n\nLayoutSection.propTypes = {\n  children: PropTypes.node,\n  className: PropTypes.string\n};\n\nconst Container = props => /*#__PURE__*/React.createElement(LayoutSection, _extends({}, props, {\n  className: classes.container\n}));\n\nconst Top = props => /*#__PURE__*/React.createElement(LayoutSection, _extends({}, props, {\n  className: classes.top\n}));\n\nconst Content = props => /*#__PURE__*/React.createElement(LayoutSection, _extends({}, props, {\n  className: classes.content\n}));\n\nconst Bottom = props => /*#__PURE__*/React.createElement(LayoutSection, _extends({}, props, {\n  className: classes.bottom\n}));\n\nexport const Layout = {\n  Container,\n  Top,\n  Content,\n  Bottom\n};","import { App } from './app.js';\nexport default App;","import { CssVariables } from '@dhis2/ui';\nimport React from 'react';\nimport { QueryParamProvider } from 'use-query-params';\nimport { ActionBar } from '../action-bar';\nimport { AuthWall } from '../auth';\nimport { ContextSelector } from '../context-selector';\nimport { CurrentUserProvider } from '../current-user';\nimport { DataWorkspace } from '../data-workspace';\nimport { Layout } from './layout.js';\n\nconst App = () => /*#__PURE__*/React.createElement(QueryParamProvider, null, /*#__PURE__*/React.createElement(CssVariables, {\n  spacers: true,\n  colors: true,\n  theme: true\n}), /*#__PURE__*/React.createElement(CurrentUserProvider, null, /*#__PURE__*/React.createElement(AuthWall, null, /*#__PURE__*/React.createElement(Layout.Container, null, /*#__PURE__*/React.createElement(Layout.Top, null, /*#__PURE__*/React.createElement(ContextSelector, null)), /*#__PURE__*/React.createElement(Layout.Content, null, /*#__PURE__*/React.createElement(DataWorkspace, null)), /*#__PURE__*/React.createElement(Layout.Bottom, null, /*#__PURE__*/React.createElement(ActionBar, null))))));\n\nexport { App };"],"sourceRoot":""}